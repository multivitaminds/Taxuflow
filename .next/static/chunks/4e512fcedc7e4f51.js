(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,671759,e=>{"use strict";let t=(0,e.i(40530).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",0,t],671759)},561383,e=>{"use strict";let t=(0,e.i(40530).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",0,t],561383)},823018,e=>{"use strict";var t=e.i(437322),s=e.i(949161);e.i(29157);var i=e.i(621914),r=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,r)=>{let a=(0,i.createSlot)(`Primitive.${r}`),n=s.forwardRef((e,s)=>{let{asChild:i,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(i?a:r,{...n,ref:s})});return n.displayName=`Primitive.${r}`,{...e,[r]:n}},{}),a=s.forwardRef((e,s)=>(0,t.jsx)(r.label,{...e,ref:s,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));a.displayName="Label";var n=e.i(333642);e.s(["Label",0,function({className:e,...s}){return(0,t.jsx)(a,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...s})}],823018)},409340,e=>{"use strict";var t=e.i(949161);e.s(["usePrevious",0,function(e){let s=t.useRef({value:e,previous:e});return t.useMemo(()=>(s.current.value!==e&&(s.current.previous=s.current.value,s.current.value=e),s.current.previous),[e])}])},924576,e=>{"use strict";let t=(0,e.i(40530).default)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);e.s(["default",0,t])},226002,e=>{"use strict";var t=e.i(437322),s=e.i(333642);e.s(["Textarea",0,function({className:e,...i}){return(0,t.jsx)("textarea",{"data-slot":"textarea",className:(0,s.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...i})}])},419391,e=>{"use strict";var t=e.i(780212);e.s(["getSupabaseBooksClient",0,function(){return(0,t.createClient)()}])},755750,e=>{"use strict";var t=e.i(437322),s=e.i(949161),i=e.i(285937),r=e.i(363284),a=e.i(594950),n=e.i(844994),o=e.i(823018),l=e.i(226002),c=e.i(838589),d=e.i(316434),u=e.i(561383),m=e.i(671759),p=e.i(511531),v=e.i(419391),h=e.i(780212);e.s(["InvoiceFormClient",0,function(){let e=(0,i.useRouter)(),[x,g]=(0,s.useState)(!1),[f,b]=(0,s.useState)(!0),[j,y]=(0,s.useState)([]),[N,_]=(0,s.useState)({customer_id:"",invoice_number:`INV-${Date.now()}`,invoice_date:new Date().toISOString().split("T")[0],due_date:new Date(Date.now()+2592e6).toISOString().split("T")[0],notes:"",terms:"Net 30"}),[w,C]=(0,s.useState)([{description:"",quantity:1,unit_price:0,amount:0}]);async function S(){console.log("[v0] Loading customers..."),b(!0);try{let e=(0,v.getSupabaseBooksClient)(),t=(0,h.createClient)(),s=[];if(e){let{data:t,error:i}=await e.from("contacts").select("*").eq("kind","customer").order("display_name");!i&&t?(console.log("[v0] Loaded",t.length,"customers from books.contacts"),s=[...s,...t.map(e=>({...e,source:"books"}))]):i&&console.error("[v0] Error loading from books.contacts:",i)}let{data:i,error:r}=await t.from("customers").select("*").eq("is_active",!0).order("company_name");if(!r&&i?(console.log("[v0] Loaded",i.length,"customers from public.customers"),s=[...s,...i.map(e=>({id:e.id,display_name:e.company_name||e.contact_name||"Unnamed Customer",email:e.email,source:"public"}))]):r&&console.error("[v0] Error loading from public.customers:",r),0===s.length){let{data:e,error:i}=await t.from("contacts").select("*").eq("contact_type","customer").order("name");!i&&e&&(console.log("[v0] Loaded",e.length,"customers from public.contacts"),s=e.map(e=>({id:e.id,display_name:e.display_name||e.name||e.company_name||"Unnamed Customer",email:e.email,source:"contacts"})))}console.log("[v0] Total customers loaded:",s.length),y(s)}catch(e){console.error("[v0] Error loading customers:",e)}finally{b(!1)}}function L(e,t,s){let i=[...w];i[e]={...i[e],[t]:s},("quantity"===t||"unit_price"===t)&&(i[e].amount=i[e].quantity*i[e].unit_price),C(i)}(0,s.useEffect)(()=>{S()},[]);let k=w.reduce((e,t)=>e+t.amount,0),I=.1*k,T=k+I;async function q(t){t.preventDefault(),g(!0);try{console.log("[v0] Creating invoice with data:",{...N,items:w});let t=await fetch("/api/accounting/invoices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_id:N.customer_id,invoice_number:N.invoice_number,invoice_date:N.invoice_date,due_date:N.due_date,notes:N.notes,terms:N.terms,items:w})}),s=await t.json();if(!t.ok)throw console.error("[v0] Invoice creation failed:",s),Error(s.error||"Failed to create invoice");console.log("[v0] Invoice created successfully:",s),e.push("/accounting/invoices")}catch(e){console.error("[v0] Error creating invoice:",e),alert(e instanceof Error?e.message:"Failed to create invoice")}finally{g(!1)}}return(0,t.jsx)("form",{onSubmit:q,children:(0,t.jsxs)(a.Card,{className:"p-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(o.Label,{htmlFor:"customer",children:"Customer *"}),(0,t.jsxs)(c.Select,{value:N.customer_id,onValueChange:e=>{console.log("[v0] Selected customer:",e),_({...N,customer_id:e})},disabled:f,children:[(0,t.jsx)(c.SelectTrigger,{children:(0,t.jsx)(c.SelectValue,{placeholder:f?"Loading customers...":0===j.length?"No customers found":"Select customer"})}),(0,t.jsxs)(c.SelectContent,{children:[0===j.length&&!f&&(0,t.jsxs)("div",{className:"p-4 text-center text-sm text-muted-foreground",children:["No customers available."," ",(0,t.jsx)(p.default,{href:"/accounting/customers",className:"text-primary underline",children:"Add a customer"})," ","first."]}),j.map(e=>(0,t.jsxs)(c.SelectItem,{value:e.id,children:[e.display_name," ",e.email&&`(${e.email})`]},e.id))]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(o.Label,{htmlFor:"invoice_number",children:"Invoice Number *"}),(0,t.jsx)(n.Input,{id:"invoice_number",value:N.invoice_number,onChange:e=>_({...N,invoice_number:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(o.Label,{htmlFor:"invoice_date",children:"Invoice Date *"}),(0,t.jsx)(n.Input,{id:"invoice_date",type:"date",value:N.invoice_date,onChange:e=>_({...N,invoice_date:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(o.Label,{htmlFor:"due_date",children:"Due Date *"}),(0,t.jsx)(n.Input,{id:"due_date",type:"date",value:N.due_date,onChange:e=>_({...N,due_date:e.target.value}),required:!0})]})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)(o.Label,{children:"Line Items"}),(0,t.jsxs)(r.Button,{type:"button",variant:"outline",size:"sm",onClick:function(){C([...w,{description:"",quantity:1,unit_price:0,amount:0}])},children:[(0,t.jsx)(d.Plus,{className:"h-4 w-4 mr-2"}),"Add Line"]})]}),(0,t.jsx)("div",{className:"space-y-4",children:w.map((e,s)=>(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-4 items-end",children:[(0,t.jsxs)("div",{className:"col-span-5",children:[(0,t.jsx)(o.Label,{children:"Description"}),(0,t.jsx)(n.Input,{value:e.description,onChange:e=>L(s,"description",e.target.value),placeholder:"Item description",required:!0})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)(o.Label,{children:"Quantity"}),(0,t.jsx)(n.Input,{type:"number",value:e.quantity,onChange:e=>L(s,"quantity",Number.parseFloat(e.target.value)||0),min:"0",step:"0.01",required:!0})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)(o.Label,{children:"Unit Price"}),(0,t.jsx)(n.Input,{type:"number",value:e.unit_price,onChange:e=>L(s,"unit_price",Number.parseFloat(e.target.value)||0),min:"0",step:"0.01",required:!0})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)(o.Label,{children:"Amount"}),(0,t.jsx)(n.Input,{value:`$${e.amount.toFixed(2)}`,disabled:!0})]}),(0,t.jsx)("div",{className:"col-span-1",children:(0,t.jsx)(r.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>{C(w.filter((e,t)=>t!==s))},disabled:1===w.length,children:(0,t.jsx)(u.Trash2,{className:"h-4 w-4"})})})]},s))})]}),(0,t.jsx)("div",{className:"border-t pt-6 mb-6",children:(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsxs)("div",{className:"w-64 space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Subtotal:"}),(0,t.jsxs)("span",{className:"font-medium",children:["$",k.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Tax (10%):"}),(0,t.jsxs)("span",{className:"font-medium",children:["$",I.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[(0,t.jsx)("span",{children:"Total:"}),(0,t.jsxs)("span",{children:["$",T.toFixed(2)]})]})]})})}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-6 mb-6",children:(0,t.jsxs)("div",{children:[(0,t.jsx)(o.Label,{htmlFor:"terms",children:"Payment Terms"}),(0,t.jsx)(n.Input,{id:"terms",value:N.terms,onChange:e=>_({...N,terms:e.target.value}),placeholder:"Net 30"})]})}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)(o.Label,{htmlFor:"notes",children:"Notes"}),(0,t.jsx)(l.Textarea,{id:"notes",value:N.notes,onChange:e=>_({...N,notes:e.target.value}),placeholder:"Additional notes or terms...",rows:4})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,t.jsx)(p.default,{href:"/accounting/invoices",children:(0,t.jsxs)(r.Button,{type:"button",variant:"outline",children:[(0,t.jsx)(m.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Cancel"]})}),(0,t.jsx)(r.Button,{type:"submit",disabled:x||!N.customer_id||0===w.length||w.some(e=>!e.description),className:"bg-gradient-to-r from-purple-600 to-orange-500 hover:from-purple-700 hover:to-orange-600",children:x?"Creating...":"Create Invoice"})]})]})})}])}]);