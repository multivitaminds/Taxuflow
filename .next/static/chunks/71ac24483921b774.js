(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,669980,e=>{"use strict";let t=(0,e.i(40530).default)("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",0,t],669980)},550968,e=>{"use strict";let t=(0,e.i(40530).default)("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);e.s(["Download",0,t],550968)},408173,e=>{"use strict";let t=(0,e.i(40530).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);e.s(["Clock",0,t],408173)},965957,e=>{"use strict";let t=(0,e.i(40530).default)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);e.s(["CheckCircle2",0,t],965957)},176359,e=>{"use strict";let t=(0,e.i(40530).default)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",0,t],176359)},561383,e=>{"use strict";let t=(0,e.i(40530).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",0,t],561383)},625856,e=>{"use strict";let t=(0,e.i(40530).default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["default",0,t])},109540,e=>{"use strict";var t=e.i(625856);e.s(["X",()=>t.default])},679411,e=>{"use strict";let t=(0,e.i(40530).default)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);e.s(["Upload",0,t],679411)},187189,e=>{"use strict";let t=(0,e.i(40530).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",0,t],187189)},616861,e=>{"use strict";e.i(437322);var t=e.i(949161);let s=(0,t.createContext)({user:null,profile:null,loading:!1,refreshProfile:async()=>{},features:{banking:!1,wallet:!1,accounting:!1,tax_filing:!1,api_access:!1,developer_portal:!1,employee_management:!1},userType:"regular",canAccess:()=>!1});e.s(["useDashboard",0,function(){return(0,t.useContext)(s)}])},311077,e=>{"use strict";var t=e.i(437322),s=e.i(616861),r=e.i(949161),a=e.i(285937),o=e.i(363284),l=e.i(594950),n=e.i(671759),i=e.i(669980),c=e.i(679411),d=e.i(550968),m=e.i(561383),u=e.i(965957),p=e.i(408173),x=e.i(780212),h=e.i(109540),g=e.i(187189),f=e.i(176359);function b({onUploadComplete:e}){let[s,a]=(0,r.useState)([]),[n,d]=(0,r.useState)(!1),m=(0,x.createClient)(),p=async(t,r)=>{console.log("[v0] Starting file upload:",t.name);try{let o,l=t.size>0xa00000?"File size must be less than 10MB":["application/pdf","image/jpeg","image/jpg","image/png","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(t.type)?null:"Only PDF, JPG, PNG, and DOCX files are allowed";if(l){console.error("[v0] Validation failed:",l),a(e=>e.map((e,t)=>t===r?{...e,status:"error",error:l}:e));return}let{data:{user:n},error:i}=await m.auth.getUser();if(i||!n){console.error("[v0] User error:",i),a(e=>e.map((e,t)=>t===r?{...e,status:"error",error:"Please sign in to upload documents"}:e));return}console.log("[v0] User authenticated:",n.id);let c=Date.now(),d=t.name.replace(/[^a-zA-Z0-9.-]/g,"_"),u=`${n.id}/${c}-${d}`;console.log("[v0] Uploading to storage..."),a(e=>e.map((e,t)=>t===r?{...e,progress:"Uploading to secure storage..."}:e));let{data:p,error:x}=await m.storage.from("tax-documents").upload(u,t,{cacheControl:"3600",upsert:!1});if(x){console.error("[v0] Upload error:",x);let e=`Upload failed: ${x.message}`;(x.message.includes("not found")||x.message.includes("does not exist"))&&(e="Storage bucket not set up. Please run the database setup scripts first."),a(t=>t.map((t,s)=>s===r?{...t,status:"error",error:e}:t));return}console.log("[v0] File uploaded to storage successfully");let{data:{publicUrl:h}}=m.storage.from("tax-documents").getPublicUrl(u),g=(o=t.name.toLowerCase()).includes("w-2")||o.includes("w2")?"w2":o.includes("1099")?"1099":o.includes("receipt")?"receipt":"other",f=new Date().getFullYear();console.log("[v0] Saving document metadata..."),a(e=>e.map((e,t)=>t===r?{...e,progress:"Saving document information..."}:e));let{data:b,error:y}=await m.from("documents").insert({user_id:n.id,file_name:t.name,file_path:u,file_url:h,file_size:t.size,file_type:t.type,document_type:g,tax_year:f}).select().single();if(y){console.error("[v0] Database error:",y);let e=`Failed to save document info: ${y.message}`;y.message.includes("relation")&&y.message.includes("does not exist")&&(e="Database table not set up. Please run the database setup scripts first."),a(t=>t.map((t,s)=>s===r?{...t,status:"error",error:e}:t));return}console.log("[v0] Document saved successfully:",b.id),console.log("[v0] Starting AI document processing..."),a(e=>e.map((e,t)=>t===r?{...e,status:"processing",progress:"Sophie is analyzing with AI vision...",documentId:b.id}:e));try{let t=await fetch("/api/process-document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({documentId:b.id})});if(console.log("[v0] Process document response status:",t.status),!t.ok){let e=await t.json();throw console.error("[v0] Processing API error:",e),Error(e.error||"Processing failed")}let o=await t.json();console.log("[v0] Document processing complete:",o),a(e=>e.map((e,t)=>t===r?{...e,status:"complete",progress:`All 5 AI agents analyzed your ${o.documentType?.toUpperCase()||"document"}!`}:e)),setTimeout(()=>{a(e=>e.filter((e,t)=>t!==r)),1===s.filter(e=>"complete"!==e.status).length&&(console.log("[v0] All files processed, refreshing dashboard"),e&&e())},3e3)}catch(e){console.error("[v0] Processing error:",e),a(e=>e.map((e,t)=>t===r?{...e,status:"error",error:"Document uploaded but AI processing failed"}:e))}}catch(e){console.error("[v0] Unexpected error:",e),a(e=>e.map((e,t)=>t===r?{...e,status:"error",error:"An unexpected error occurred"}:e))}},b=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?d(!0):"dragleave"===e.type&&d(!1)};return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:`relative border-2 border-dashed rounded-lg p-8 text-center transition-colors ${n?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onDragEnter:b,onDragLeave:b,onDragOver:b,onDrop:e=>{e.preventDefault(),e.stopPropagation(),d(!1);let t=Array.from(e.dataTransfer.files||[]);if(t.length>0){console.log("[v0] Dropped",t.length,"files");let e=t.map(e=>({file:e,status:"uploading",progress:"Starting upload..."}));a(t=>[...t,...e]),t.forEach((e,t)=>{p(e,s.length+t)})}},children:[(0,t.jsx)("input",{type:"file",id:"file-upload",className:"hidden",onChange:e=>{let t=Array.from(e.target.files||[]);if(t.length>0){console.log("[v0] Selected",t.length,"files for upload");let e=t.map(e=>({file:e,status:"uploading",progress:"Starting upload..."}));a(t=>[...t,...e]),t.forEach((e,t)=>{p(e,s.length+t)})}e.target.value=""},accept:".pdf,.jpg,.jpeg,.png,.docx",multiple:!0}),(0,t.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer flex flex-col items-center gap-2",children:[(0,t.jsx)(c.Upload,{className:"h-12 w-12 text-muted-foreground"}),(0,t.jsxs)("div",{className:"space-y-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:"Drop your tax documents here"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"or click to browse (PDF, JPG, PNG, DOCX - max 10MB each)"}),(0,t.jsx)("p",{className:"text-xs text-primary font-medium mt-2",children:"You can upload multiple files at once"})]})]})]}),s.map((e,s)=>(0,t.jsx)(l.Card,{className:`p-4 ${"complete"===e.status?"bg-green-500/10 border-green-500":"error"===e.status?"bg-destructive/10 border-destructive":"bg-primary/10 border-primary"}`,children:(0,t.jsxs)("div",{className:"flex items-start gap-2",children:["complete"===e.status?(0,t.jsx)(u.CheckCircle2,{className:"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0"}):"error"===e.status?(0,t.jsx)(f.AlertCircle,{className:"h-5 w-5 text-destructive mt-0.5 flex-shrink-0"}):(0,t.jsx)(g.Loader2,{className:"h-5 w-5 text-primary mt-0.5 flex-shrink-0 animate-spin"}),(0,t.jsx)(i.FileText,{className:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsx)("p",{className:`text-sm font-medium truncate ${"complete"===e.status?"text-green-500":"error"===e.status?"text-destructive":"text-primary"}`,children:e.file.name}),(0,t.jsx)("p",{className:`text-xs mt-1 ${"complete"===e.status?"text-green-500/80":"error"===e.status?"text-destructive/80":"text-primary/80"}`,children:"error"===e.status?e.error:e.progress}),"processing"===e.status&&(0,t.jsxs)("div",{className:"mt-3 space-y-1",children:[(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"• Sophie: Document analysis"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"• Leo: Tax calculations"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"• Riley: Deduction discovery"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"• Kai: Audit risk assessment"}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:"• Jordan: Tax strategy"})]})]}),"error"===e.status&&(0,t.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:()=>{a(e=>e.filter((e,t)=>t!==s))},className:"h-6 w-6 p-0 flex-shrink-0",children:(0,t.jsx)(h.X,{className:"h-4 w-4"})})]})},s))]})}function y({user:e,profile:s}){let h=(0,a.useRouter)(),[g,f]=(0,r.useState)([]),[y,j]=(0,r.useState)(!0),[v,N]=(0,r.useState)(!1);console.log("[v0] DocumentsDetailsClient rendering",{user:!!e,profile:!!s});let k=(0,x.createClient)(),w=async()=>{j(!0),console.log("[v0] Fetching documents for user",e.id);let{data:t,error:s}=await k.from("documents").select("*").eq("user_id",e.id).order("created_at",{ascending:!1});console.log("[v0] Documents fetched",{count:t?.length,error:s}),t&&f(t),j(!1)};(0,r.useEffect)(()=>{w()},[e.id]);let C=async(e,t)=>{try{let{data:s,error:r}=await k.from("documents").select("file_path").eq("id",e).single();if(r||!s)return void alert("Failed to download document. Please try again.");let{data:a,error:o}=await k.storage.from("tax-documents").download(s.file_path);if(o)return void alert("Failed to download file. Please try again.");let l=URL.createObjectURL(a),n=document.createElement("a");n.href=l,n.download=t,n.click(),URL.revokeObjectURL(l)}catch(e){alert("An unexpected error occurred. Please try again.")}},D=async(e,t)=>{if(window.confirm(`Are you sure you want to delete "${t}"? This action cannot be undone.`))try{let t=await fetch(`/api/delete-document?id=${e}`,{method:"DELETE"}),s=await t.json();if(!t.ok)return void alert(`Failed to delete document: ${s.error}`);alert("Document deleted successfully"),w()}catch(e){alert("An unexpected error occurred. Please try again.")}},_={w2:g.filter(e=>"w2"===e.ai_document_type),1099:g.filter(e=>"1099"===e.ai_document_type),1040:g.filter(e=>"1040"===e.ai_document_type),receipts:g.filter(e=>"receipt"===e.ai_document_type),other:g.filter(e=>!e.ai_document_type||"other"===e.ai_document_type)};return y?(0,t.jsx)("div",{className:"min-h-screen bg-background pt-8 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-16 h-16 border-4 border-neon border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading documents..."})]})}):(0,t.jsxs)("div",{className:"min-h-screen bg-background pt-3.5",children:[(0,t.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,t.jsxs)(o.Button,{onClick:()=>h.push("/dashboard"),variant:"ghost",className:"mb-6",children:[(0,t.jsx)(n.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-4xl font-bold mb-2",children:"Your Documents"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Manage and organize all your tax documents"})]}),(0,t.jsxs)(o.Button,{onClick:()=>N(!0),className:"bg-neon hover:bg-neon/90 text-background",children:[(0,t.jsx)(c.Upload,{className:"w-4 h-4 mr-2"}),"Upload Document"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,t.jsxs)(l.Card,{className:"p-6 border-neon/20 bg-card/50 backdrop-blur cursor-pointer hover:bg-card/70 hover:border-neon/40 transition-all",onClick:()=>h.push("/dashboard/documents/all"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)(i.FileText,{className:"w-5 h-5 text-neon"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total Documents"})]}),(0,t.jsx)("p",{className:"text-3xl font-bold",children:g.length})]}),(0,t.jsxs)(l.Card,{className:"p-6 border-neon/20 bg-card/50 backdrop-blur cursor-pointer hover:bg-card/70 hover:border-neon/40 transition-all",onClick:()=>h.push("/dashboard/documents/processed"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)(u.CheckCircle2,{className:"w-5 h-5 text-green-500"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Processed"})]}),(0,t.jsx)("p",{className:"text-3xl font-bold",children:g.filter(e=>e.ai_document_type).length})]}),(0,t.jsxs)(l.Card,{className:"p-6 border-neon/20 bg-card/50 backdrop-blur cursor-pointer hover:bg-card/70 hover:border-neon/40 transition-all",onClick:()=>h.push("/dashboard/documents/processing"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)(p.Clock,{className:"w-5 h-5 text-yellow-500"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Processing"})]}),(0,t.jsx)("p",{className:"text-3xl font-bold",children:g.filter(e=>!e.ai_document_type).length})]}),(0,t.jsxs)(l.Card,{className:"p-6 border-neon/20 bg-card/50 backdrop-blur cursor-pointer hover:bg-card/70 hover:border-neon/40 transition-all",onClick:()=>h.push("/dashboard/documents/storage"),children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,t.jsx)(i.FileText,{className:"w-5 h-5 text-blue-500"}),(0,t.jsx)("span",{className:"text-sm text-muted-foreground",children:"Storage Used"})]}),(0,t.jsxs)("p",{className:"text-3xl font-bold",children:[(g.reduce((e,t)=>e+t.file_size,0)/1024/1024).toFixed(1)," MB"]})]})]}),(0,t.jsx)("div",{className:"space-y-6",children:Object.entries(_).map(([e,s])=>0===s.length?null:(0,t.jsxs)(l.Card,{className:"p-6 border-neon/20 bg-card/50 backdrop-blur",children:[(0,t.jsx)("h3",{className:"text-xl font-bold mb-4 capitalize",children:"1099"===e?"1099 Forms":"w2"===e?"W-2 Forms":"1040"===e?"1040 Forms":e}),(0,t.jsx)("div",{className:"space-y-3",children:s.map(e=>{let s=e.ai_document_type?{status:"processed",label:"Processed",icon:u.CheckCircle2,color:"text-green-500"}:{status:"pending",label:"Processing",icon:p.Clock,color:"text-yellow-500"},r=s.icon;return(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-background/50 hover:bg-background/80 transition-all",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(i.FileText,{className:"w-6 h-6 text-neon"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold",children:e.file_name}),(0,t.jsxs)("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[(0,t.jsx)("span",{children:new Date(e.created_at).toLocaleDateString()}),(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{children:[(e.file_size/1024).toFixed(1)," KB"]}),(0,t.jsx)("span",{children:"•"}),(0,t.jsxs)("span",{className:`flex items-center gap-1 ${s.color}`,children:[(0,t.jsx)(r,{className:"w-4 h-4"}),s.label]})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(o.Button,{onClick:()=>C(e.id,e.file_name),variant:"ghost",size:"sm",children:(0,t.jsx)(d.Download,{className:"w-4 h-4"})}),(0,t.jsx)(o.Button,{onClick:()=>D(e.id,e.file_name),variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-600 hover:bg-red-500/10",children:(0,t.jsx)(m.Trash2,{className:"w-4 h-4"})})]})]},e.id)})})]},e))}),0===g.length&&(0,t.jsxs)(l.Card,{className:"p-12 border-neon/20 bg-card/50 backdrop-blur text-center cursor-pointer hover:bg-card/70 hover:border-neon/40 transition-all group",onClick:()=>N(!0),children:[(0,t.jsx)(i.FileText,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4 group-hover:text-neon transition-colors"}),(0,t.jsx)("h3",{className:"text-xl font-bold mb-2",children:"No documents uploaded yet"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-6",children:"Upload your first tax document to get started"}),(0,t.jsxs)(o.Button,{className:"bg-neon hover:bg-neon/90 text-background pointer-events-none",children:[(0,t.jsx)(c.Upload,{className:"w-4 h-4 mr-2"}),"Upload Document"]})]})]}),v&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,t.jsxs)(l.Card,{className:"w-full max-w-2xl p-6 border-neon/20 bg-card",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold",children:"Upload Tax Documents"}),(0,t.jsx)(o.Button,{variant:"ghost",size:"sm",onClick:()=>N(!1),children:"✕"})]}),(0,t.jsx)(b,{onUploadComplete:()=>{N(!1),w()}}),(0,t.jsx)("div",{className:"mt-6 pt-6 border-t border-border",children:(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Supported formats: PDF, JPG, PNG, DOCX (max 10MB)"})})]})})]})}e.s(["default",0,function(){let{user:e,profile:r}=(0,s.useDashboard)();return(0,t.jsx)(y,{user:e,profile:r})}],311077)}]);