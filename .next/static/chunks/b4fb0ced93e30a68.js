(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,594950,e=>{"use strict";var t=e.i(437322),r=e.i(333642);e.s(["Card",0,function({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border border-border/50 py-6 shadow-sm transition-shadow hover:shadow-md",e),...i})},"CardContent",0,function({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",e),...i})},"CardDescription",0,function({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",e),...i})},"CardHeader",0,function({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...i})},"CardTitle",0,function({className:e,...i}){return(0,t.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",e),...i})}])},671759,e=>{"use strict";let t=(0,e.i(40530).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);e.s(["ArrowLeft",0,t],671759)},561383,e=>{"use strict";let t=(0,e.i(40530).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",0,t],561383)},844994,e=>{"use strict";var t=e.i(437322),r=e.i(333642);e.s(["Input",0,function({className:e,type:i,...a}){return(0,t.jsx)("input",{type:i,"data-slot":"input",className:(0,r.cn)("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input h-10 w-full min-w-0 rounded-lg border bg-transparent px-3 py-1 text-base shadow-sm transition-all outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-[#635bff] focus-visible:ring-[#635bff]/20 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...a})}])},823018,e=>{"use strict";var t=e.i(437322),r=e.i(949161);e.i(29157);var i=e.i(621914),a=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,a)=>{let s=(0,i.createSlot)(`Primitive.${a}`),n=r.forwardRef((e,r)=>{let{asChild:i,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,t.jsx)(i?s:a,{...n,ref:r})});return n.displayName=`Primitive.${a}`,{...e,[a]:n}},{}),s=r.forwardRef((e,r)=>(0,t.jsx)(a.label,{...e,ref:r,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));s.displayName="Label";var n=e.i(333642);e.s(["Label",0,function({className:e,...r}){return(0,t.jsx)(s,{"data-slot":"label",className:(0,n.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...r})}],823018)},409340,e=>{"use strict";var t=e.i(949161);e.s(["usePrevious",0,function(e){let r=t.useRef({value:e,previous:e});return t.useMemo(()=>(r.current.value!==e&&(r.current.previous=r.current.value,r.current.value=e),r.current.previous),[e])}])},263114,e=>{"use strict";let t=(0,e.i(40530).default)("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["default",0,t])},924576,e=>{"use strict";let t=(0,e.i(40530).default)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);e.s(["default",0,t])},419391,e=>{"use strict";var t=e.i(780212);e.s(["getSupabaseBooksClient",0,function(){return(0,t.createClient)()}])},226002,e=>{"use strict";var t=e.i(437322),r=e.i(333642);e.s(["Textarea",0,function({className:e,...i}){return(0,t.jsx)("textarea",{"data-slot":"textarea",className:(0,r.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...i})}])},755750,e=>{"use strict";var t=e.i(437322),r=e.i(949161),i=e.i(285937),a=e.i(363284),s=e.i(594950),n=e.i(844994),o=e.i(823018),l=e.i(226002),d=e.i(838589),c=e.i(316434),u=e.i(561383),m=e.i(671759),p=e.i(511531),v=e.i(419391),x=e.i(780212);e.s(["InvoiceFormClient",0,function(){let e=(0,i.useRouter)(),[h,f]=(0,r.useState)(!1),[g,b]=(0,r.useState)(!0),[j,y]=(0,r.useState)([]),[N,w]=(0,r.useState)({customer_id:"",invoice_number:`INV-${Date.now()}`,invoice_date:new Date().toISOString().split("T")[0],due_date:new Date(Date.now()+2592e6).toISOString().split("T")[0],notes:"",terms:"Net 30"}),[_,C]=(0,r.useState)([{description:"",quantity:1,unit_price:0,amount:0}]);async function S(){console.log("[v0] Loading customers..."),b(!0);try{let e=(0,v.getSupabaseBooksClient)(),t=(0,x.createClient)(),r=[];if(e){let{data:t,error:i}=await e.from("contacts").select("*").eq("kind","customer").order("display_name");!i&&t?(console.log("[v0] Loaded",t.length,"customers from books.contacts"),r=[...r,...t.map(e=>({...e,source:"books"}))]):i&&console.error("[v0] Error loading from books.contacts:",i)}let{data:i,error:a}=await t.from("customers").select("*").eq("is_active",!0).order("company_name");if(!a&&i?(console.log("[v0] Loaded",i.length,"customers from public.customers"),r=[...r,...i.map(e=>({id:e.id,display_name:e.company_name||e.contact_name||"Unnamed Customer",email:e.email,source:"public"}))]):a&&console.error("[v0] Error loading from public.customers:",a),0===r.length){let{data:e,error:i}=await t.from("contacts").select("*").eq("contact_type","customer").order("name");!i&&e&&(console.log("[v0] Loaded",e.length,"customers from public.contacts"),r=e.map(e=>({id:e.id,display_name:e.display_name||e.name||e.company_name||"Unnamed Customer",email:e.email,source:"contacts"})))}console.log("[v0] Total customers loaded:",r.length),y(r)}catch(e){console.error("[v0] Error loading customers:",e)}finally{b(!1)}}function k(e,t,r){let i=[..._];i[e]={...i[e],[t]:r},("quantity"===t||"unit_price"===t)&&(i[e].amount=i[e].quantity*i[e].unit_price),C(i)}(0,r.useEffect)(()=>{S()},[]);let L=_.reduce((e,t)=>e+t.amount,0),I=.1*L,T=L+I;async function q(t){t.preventDefault(),f(!0);try{console.log("[v0] Creating invoice with data:",{...N,items:_});let t=await fetch("/api/accounting/invoices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_id:N.customer_id,invoice_number:N.invoice_number,invoice_date:N.invoice_date,due_date:N.due_date,notes:N.notes,terms:N.terms,items:_})}),r=await t.json();if(!t.ok)throw console.error("[v0] Invoice creation failed:",r),Error(r.error||"Failed to create invoice");console.log("[v0] Invoice created successfully:",r),e.push("/accounting/invoices")}catch(e){console.error("[v0] Error creating invoice:",e),alert(e instanceof Error?e.message:"Failed to create invoice")}finally{f(!1)}}return(0,t.jsx)("form",{onSubmit:q,children:(0,t.jsxs)(s.Card,{className:"p-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(o.Label,{htmlFor:"customer",children:"Customer *"}),(0,t.jsxs)(d.Select,{value:N.customer_id,onValueChange:e=>{console.log("[v0] Selected customer:",e),w({...N,customer_id:e})},disabled:g,children:[(0,t.jsx)(d.SelectTrigger,{children:(0,t.jsx)(d.SelectValue,{placeholder:g?"Loading customers...":0===j.length?"No customers found":"Select customer"})}),(0,t.jsxs)(d.SelectContent,{children:[0===j.length&&!g&&(0,t.jsxs)("div",{className:"p-4 text-center text-sm text-muted-foreground",children:["No customers available."," ",(0,t.jsx)(p.default,{href:"/accounting/customers",className:"text-primary underline",children:"Add a customer"})," ","first."]}),j.map(e=>(0,t.jsxs)(d.SelectItem,{value:e.id,children:[e.display_name," ",e.email&&`(${e.email})`]},e.id))]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(o.Label,{htmlFor:"invoice_number",children:"Invoice Number *"}),(0,t.jsx)(n.Input,{id:"invoice_number",value:N.invoice_number,onChange:e=>w({...N,invoice_number:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(o.Label,{htmlFor:"invoice_date",children:"Invoice Date *"}),(0,t.jsx)(n.Input,{id:"invoice_date",type:"date",value:N.invoice_date,onChange:e=>w({...N,invoice_date:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(o.Label,{htmlFor:"due_date",children:"Due Date *"}),(0,t.jsx)(n.Input,{id:"due_date",type:"date",value:N.due_date,onChange:e=>w({...N,due_date:e.target.value}),required:!0})]})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)(o.Label,{children:"Line Items"}),(0,t.jsxs)(a.Button,{type:"button",variant:"outline",size:"sm",onClick:function(){C([..._,{description:"",quantity:1,unit_price:0,amount:0}])},children:[(0,t.jsx)(c.Plus,{className:"h-4 w-4 mr-2"}),"Add Line"]})]}),(0,t.jsx)("div",{className:"space-y-4",children:_.map((e,r)=>(0,t.jsxs)("div",{className:"grid grid-cols-12 gap-4 items-end",children:[(0,t.jsxs)("div",{className:"col-span-5",children:[(0,t.jsx)(o.Label,{children:"Description"}),(0,t.jsx)(n.Input,{value:e.description,onChange:e=>k(r,"description",e.target.value),placeholder:"Item description",required:!0})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)(o.Label,{children:"Quantity"}),(0,t.jsx)(n.Input,{type:"number",value:e.quantity,onChange:e=>k(r,"quantity",Number.parseFloat(e.target.value)||0),min:"0",step:"0.01",required:!0})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)(o.Label,{children:"Unit Price"}),(0,t.jsx)(n.Input,{type:"number",value:e.unit_price,onChange:e=>k(r,"unit_price",Number.parseFloat(e.target.value)||0),min:"0",step:"0.01",required:!0})]}),(0,t.jsxs)("div",{className:"col-span-2",children:[(0,t.jsx)(o.Label,{children:"Amount"}),(0,t.jsx)(n.Input,{value:`$${e.amount.toFixed(2)}`,disabled:!0})]}),(0,t.jsx)("div",{className:"col-span-1",children:(0,t.jsx)(a.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>{C(_.filter((e,t)=>t!==r))},disabled:1===_.length,children:(0,t.jsx)(u.Trash2,{className:"h-4 w-4"})})})]},r))})]}),(0,t.jsx)("div",{className:"border-t pt-6 mb-6",children:(0,t.jsx)("div",{className:"flex justify-end",children:(0,t.jsxs)("div",{className:"w-64 space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Subtotal:"}),(0,t.jsxs)("span",{className:"font-medium",children:["$",L.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{className:"text-muted-foreground",children:"Tax (10%):"}),(0,t.jsxs)("span",{className:"font-medium",children:["$",I.toFixed(2)]})]}),(0,t.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[(0,t.jsx)("span",{children:"Total:"}),(0,t.jsxs)("span",{children:["$",T.toFixed(2)]})]})]})})}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-6 mb-6",children:(0,t.jsxs)("div",{children:[(0,t.jsx)(o.Label,{htmlFor:"terms",children:"Payment Terms"}),(0,t.jsx)(n.Input,{id:"terms",value:N.terms,onChange:e=>w({...N,terms:e.target.value}),placeholder:"Net 30"})]})}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)(o.Label,{htmlFor:"notes",children:"Notes"}),(0,t.jsx)(l.Textarea,{id:"notes",value:N.notes,onChange:e=>w({...N,notes:e.target.value}),placeholder:"Additional notes or terms...",rows:4})]}),(0,t.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,t.jsx)(p.default,{href:"/accounting/invoices",children:(0,t.jsxs)(a.Button,{type:"button",variant:"outline",children:[(0,t.jsx)(m.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Cancel"]})}),(0,t.jsx)(a.Button,{type:"submit",disabled:h||!N.customer_id||0===_.length||_.some(e=>!e.description),className:"bg-gradient-to-r from-purple-600 to-orange-500 hover:from-purple-700 hover:to-orange-600",children:h?"Creating...":"Create Invoice"})]})]})})}])}]);