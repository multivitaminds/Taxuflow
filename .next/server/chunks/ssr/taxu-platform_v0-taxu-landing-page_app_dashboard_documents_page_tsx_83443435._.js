module.exports=[227536,a=>{"use strict";var b=a.i(24500),c=a.i(401883),d=a.i(598293),e=a.i(659790),f=a.i(419716),g=a.i(27866),h=a.i(30487),i=a.i(301755),j=a.i(202969),k=a.i(990681),l=a.i(504047),m=a.i(72207),n=a.i(13325),o=a.i(290130),p=a.i(473405),q=a.i(412855),r=a.i(930726);function s({onUploadComplete:a}){let[c,e]=(0,d.useState)([]),[h,k]=(0,d.useState)(!1),l=(0,o.createClient)(),n=async(b,d)=>{console.log("[v0] Starting file upload:",b.name);try{let f,g=b.size>0xa00000?"File size must be less than 10MB":["application/pdf","image/jpeg","image/jpg","image/png","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(b.type)?null:"Only PDF, JPG, PNG, and DOCX files are allowed";if(g){console.error("[v0] Validation failed:",g),e(a=>a.map((a,b)=>b===d?{...a,status:"error",error:g}:a));return}let{data:{user:h},error:i}=await l.auth.getUser();if(i||!h){console.error("[v0] User error:",i),e(a=>a.map((a,b)=>b===d?{...a,status:"error",error:"Please sign in to upload documents"}:a));return}console.log("[v0] User authenticated:",h.id);let j=Date.now(),k=b.name.replace(/[^a-zA-Z0-9.-]/g,"_"),m=`${h.id}/${j}-${k}`;console.log("[v0] Uploading to storage..."),e(a=>a.map((a,b)=>b===d?{...a,progress:"Uploading to secure storage..."}:a));let{data:n,error:o}=await l.storage.from("tax-documents").upload(m,b,{cacheControl:"3600",upsert:!1});if(o){console.error("[v0] Upload error:",o);let a=`Upload failed: ${o.message}`;(o.message.includes("not found")||o.message.includes("does not exist"))&&(a="Storage bucket not set up. Please run the database setup scripts first."),e(b=>b.map((b,c)=>c===d?{...b,status:"error",error:a}:b));return}console.log("[v0] File uploaded to storage successfully");let{data:{publicUrl:p}}=l.storage.from("tax-documents").getPublicUrl(m),q=(f=b.name.toLowerCase()).includes("w-2")||f.includes("w2")?"w2":f.includes("1099")?"1099":f.includes("receipt")?"receipt":"other",r=new Date().getFullYear();console.log("[v0] Saving document metadata..."),e(a=>a.map((a,b)=>b===d?{...a,progress:"Saving document information..."}:a));let{data:s,error:t}=await l.from("documents").insert({user_id:h.id,file_name:b.name,file_path:m,file_url:p,file_size:b.size,file_type:b.type,document_type:q,tax_year:r}).select().single();if(t){console.error("[v0] Database error:",t);let a=`Failed to save document info: ${t.message}`;t.message.includes("relation")&&t.message.includes("does not exist")&&(a="Database table not set up. Please run the database setup scripts first."),e(b=>b.map((b,c)=>c===d?{...b,status:"error",error:a}:b));return}console.log("[v0] Document saved successfully:",s.id),console.log("[v0] Starting AI document processing..."),e(a=>a.map((a,b)=>b===d?{...a,status:"processing",progress:"Sophie is analyzing with AI vision...",documentId:s.id}:a));try{let b=await fetch("/api/process-document",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({documentId:s.id})});if(console.log("[v0] Process document response status:",b.status),!b.ok){let a=await b.json();throw console.error("[v0] Processing API error:",a),Error(a.error||"Processing failed")}let f=await b.json();console.log("[v0] Document processing complete:",f),e(a=>a.map((a,b)=>b===d?{...a,status:"complete",progress:`All 5 AI agents analyzed your ${f.documentType?.toUpperCase()||"document"}!`}:a)),setTimeout(()=>{e(a=>a.filter((a,b)=>b!==d)),1===c.filter(a=>"complete"!==a.status).length&&(console.log("[v0] All files processed, refreshing dashboard"),a&&a())},3e3)}catch(a){console.error("[v0] Processing error:",a),e(a=>a.map((a,b)=>b===d?{...a,status:"error",error:"Document uploaded but AI processing failed"}:a))}}catch(a){console.error("[v0] Unexpected error:",a),e(a=>a.map((a,b)=>b===d?{...a,status:"error",error:"An unexpected error occurred"}:a))}},s=a=>{a.preventDefault(),a.stopPropagation(),"dragenter"===a.type||"dragover"===a.type?k(!0):"dragleave"===a.type&&k(!1)};return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:`relative border-2 border-dashed rounded-lg p-8 text-center transition-colors ${h?"border-primary bg-primary/5":"border-border hover:border-primary/50"}`,onDragEnter:s,onDragLeave:s,onDragOver:s,onDrop:a=>{a.preventDefault(),a.stopPropagation(),k(!1);let b=Array.from(a.dataTransfer.files||[]);if(b.length>0){console.log("[v0] Dropped",b.length,"files");let a=b.map(a=>({file:a,status:"uploading",progress:"Starting upload..."}));e(b=>[...b,...a]),b.forEach((a,b)=>{n(a,c.length+b)})}},children:[(0,b.jsx)("input",{type:"file",id:"file-upload",className:"hidden",onChange:a=>{let b=Array.from(a.target.files||[]);if(b.length>0){console.log("[v0] Selected",b.length,"files for upload");let a=b.map(a=>({file:a,status:"uploading",progress:"Starting upload..."}));e(b=>[...b,...a]),b.forEach((a,b)=>{n(a,c.length+b)})}a.target.value=""},accept:".pdf,.jpg,.jpeg,.png,.docx",multiple:!0}),(0,b.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer flex flex-col items-center gap-2",children:[(0,b.jsx)(j.Upload,{className:"h-12 w-12 text-muted-foreground"}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("p",{className:"text-sm font-medium",children:"Drop your tax documents here"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"or click to browse (PDF, JPG, PNG, DOCX - max 10MB each)"}),(0,b.jsx)("p",{className:"text-xs text-primary font-medium mt-2",children:"You can upload multiple files at once"})]})]})]}),c.map((a,c)=>(0,b.jsx)(g.Card,{className:`p-4 ${"complete"===a.status?"bg-green-500/10 border-green-500":"error"===a.status?"bg-destructive/10 border-destructive":"bg-primary/10 border-primary"}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-2",children:["complete"===a.status?(0,b.jsx)(m.CheckCircle2,{className:"h-5 w-5 text-green-500 mt-0.5 flex-shrink-0"}):"error"===a.status?(0,b.jsx)(r.AlertCircle,{className:"h-5 w-5 text-destructive mt-0.5 flex-shrink-0"}):(0,b.jsx)(q.Loader2,{className:"h-5 w-5 text-primary mt-0.5 flex-shrink-0 animate-spin"}),(0,b.jsx)(i.FileText,{className:"h-5 w-5 text-muted-foreground mt-0.5 flex-shrink-0"}),(0,b.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,b.jsx)("p",{className:`text-sm font-medium truncate ${"complete"===a.status?"text-green-500":"error"===a.status?"text-destructive":"text-primary"}`,children:a.file.name}),(0,b.jsx)("p",{className:`text-xs mt-1 ${"complete"===a.status?"text-green-500/80":"error"===a.status?"text-destructive/80":"text-primary/80"}`,children:"error"===a.status?a.error:a.progress}),"processing"===a.status&&(0,b.jsxs)("div",{className:"mt-3 space-y-1",children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"• Sophie: Document analysis"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"• Leo: Tax calculations"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"• Riley: Deduction discovery"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"• Kai: Audit risk assessment"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"• Jordan: Tax strategy"})]})]}),"error"===a.status&&(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>{e(a=>a.filter((a,b)=>b!==c))},className:"h-6 w-6 p-0 flex-shrink-0",children:(0,b.jsx)(p.X,{className:"h-4 w-4"})})]})},c))]})}function t({user:a,profile:c}){let p=(0,e.useRouter)(),[q,r]=(0,d.useState)([]),[t,u]=(0,d.useState)(!0),[v,w]=(0,d.useState)(!1);console.log("[v0] DocumentsDetailsClient rendering",{user:!!a,profile:!!c});let x=(0,o.createClient)(),y=async()=>{u(!0),console.log("[v0] Fetching documents for user",a.id);let{data:b,error:c}=await x.from("documents").select("*").eq("user_id",a.id).order("created_at",{ascending:!1});console.log("[v0] Documents fetched",{count:b?.length,error:c}),b&&r(b),u(!1)};(0,d.useEffect)(()=>{y()},[a.id]);let z=async(a,b)=>{try{let{data:c,error:d}=await x.from("documents").select("file_path").eq("id",a).single();if(d||!c)return void alert("Failed to download document. Please try again.");let{data:e,error:f}=await x.storage.from("tax-documents").download(c.file_path);if(f)return void alert("Failed to download file. Please try again.");let g=URL.createObjectURL(e),h=document.createElement("a");h.href=g,h.download=b,h.click(),URL.revokeObjectURL(g)}catch(a){alert("An unexpected error occurred. Please try again.")}},A=async(a,b)=>{if(window.confirm(`Are you sure you want to delete "${b}"? This action cannot be undone.`))try{let b=await fetch(`/api/delete-document?id=${a}`,{method:"DELETE"}),c=await b.json();if(!b.ok)return void alert(`Failed to delete document: ${c.error}`);alert("Document deleted successfully"),y()}catch(a){alert("An unexpected error occurred. Please try again.")}},B={w2:q.filter(a=>"w2"===a.ai_document_type),1099:q.filter(a=>"1099"===a.ai_document_type),1040:q.filter(a=>"1040"===a.ai_document_type),receipts:q.filter(a=>"receipt"===a.ai_document_type),other:q.filter(a=>!a.ai_document_type||"other"===a.ai_document_type)};return t?(0,b.jsx)("div",{className:"min-h-screen bg-background pt-8 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"w-16 h-16 border-4 border-neon border-t-transparent rounded-full animate-spin mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Loading documents..."})]})}):(0,b.jsxs)("div",{className:"min-h-screen bg-background pt-3.5",children:[(0,b.jsxs)("div",{className:"container mx-auto px-4 py-6",children:[(0,b.jsxs)(f.Button,{onClick:()=>p.push("/dashboard"),variant:"ghost",className:"mb-6",children:[(0,b.jsx)(h.ArrowLeft,{className:"w-4 h-4 mr-2"}),"Back to Dashboard"]}),(0,b.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-4xl font-bold mb-2",children:"Your Documents"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Manage and organize all your tax documents"})]}),(0,b.jsxs)(f.Button,{onClick:()=>w(!0),className:"bg-neon hover:bg-neon/90 text-background",children:[(0,b.jsx)(j.Upload,{className:"w-4 h-4 mr-2"}),"Upload Document"]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[(0,b.jsxs)(g.Card,{className:"p-6 border-neon/20 bg-card/50 backdrop-blur cursor-pointer hover:bg-card/70 hover:border-neon/40 transition-all",onClick:()=>p.push("/dashboard/documents/all"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)(i.FileText,{className:"w-5 h-5 text-neon"}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Total Documents"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold",children:q.length})]}),(0,b.jsxs)(g.Card,{className:"p-6 border-neon/20 bg-card/50 backdrop-blur cursor-pointer hover:bg-card/70 hover:border-neon/40 transition-all",onClick:()=>p.push("/dashboard/documents/processed"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)(m.CheckCircle2,{className:"w-5 h-5 text-green-500"}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Processed"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold",children:q.filter(a=>a.ai_document_type).length})]}),(0,b.jsxs)(g.Card,{className:"p-6 border-neon/20 bg-card/50 backdrop-blur cursor-pointer hover:bg-card/70 hover:border-neon/40 transition-all",onClick:()=>p.push("/dashboard/documents/processing"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)(n.Clock,{className:"w-5 h-5 text-yellow-500"}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Processing"})]}),(0,b.jsx)("p",{className:"text-3xl font-bold",children:q.filter(a=>!a.ai_document_type).length})]}),(0,b.jsxs)(g.Card,{className:"p-6 border-neon/20 bg-card/50 backdrop-blur cursor-pointer hover:bg-card/70 hover:border-neon/40 transition-all",onClick:()=>p.push("/dashboard/documents/storage"),children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,b.jsx)(i.FileText,{className:"w-5 h-5 text-blue-500"}),(0,b.jsx)("span",{className:"text-sm text-muted-foreground",children:"Storage Used"})]}),(0,b.jsxs)("p",{className:"text-3xl font-bold",children:[(q.reduce((a,b)=>a+b.file_size,0)/1024/1024).toFixed(1)," MB"]})]})]}),(0,b.jsx)("div",{className:"space-y-6",children:Object.entries(B).map(([a,c])=>0===c.length?null:(0,b.jsxs)(g.Card,{className:"p-6 border-neon/20 bg-card/50 backdrop-blur",children:[(0,b.jsx)("h3",{className:"text-xl font-bold mb-4 capitalize",children:"1099"===a?"1099 Forms":"w2"===a?"W-2 Forms":"1040"===a?"1040 Forms":a}),(0,b.jsx)("div",{className:"space-y-3",children:c.map(a=>{let c=a.ai_document_type?{status:"processed",label:"Processed",icon:m.CheckCircle2,color:"text-green-500"}:{status:"pending",label:"Processing",icon:n.Clock,color:"text-yellow-500"},d=c.icon;return(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-background/50 hover:bg-background/80 transition-all",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(i.FileText,{className:"w-6 h-6 text-neon"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold",children:a.file_name}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-sm text-muted-foreground",children:[(0,b.jsx)("span",{children:new Date(a.created_at).toLocaleDateString()}),(0,b.jsx)("span",{children:"•"}),(0,b.jsxs)("span",{children:[(a.file_size/1024).toFixed(1)," KB"]}),(0,b.jsx)("span",{children:"•"}),(0,b.jsxs)("span",{className:`flex items-center gap-1 ${c.color}`,children:[(0,b.jsx)(d,{className:"w-4 h-4"}),c.label]})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(f.Button,{onClick:()=>z(a.id,a.file_name),variant:"ghost",size:"sm",children:(0,b.jsx)(k.Download,{className:"w-4 h-4"})}),(0,b.jsx)(f.Button,{onClick:()=>A(a.id,a.file_name),variant:"ghost",size:"sm",className:"text-red-500 hover:text-red-600 hover:bg-red-500/10",children:(0,b.jsx)(l.Trash2,{className:"w-4 h-4"})})]})]},a.id)})})]},a))}),0===q.length&&(0,b.jsxs)(g.Card,{className:"p-12 border-neon/20 bg-card/50 backdrop-blur text-center cursor-pointer hover:bg-card/70 hover:border-neon/40 transition-all group",onClick:()=>w(!0),children:[(0,b.jsx)(i.FileText,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4 group-hover:text-neon transition-colors"}),(0,b.jsx)("h3",{className:"text-xl font-bold mb-2",children:"No documents uploaded yet"}),(0,b.jsx)("p",{className:"text-muted-foreground mb-6",children:"Upload your first tax document to get started"}),(0,b.jsxs)(f.Button,{className:"bg-neon hover:bg-neon/90 text-background pointer-events-none",children:[(0,b.jsx)(j.Upload,{className:"w-4 h-4 mr-2"}),"Upload Document"]})]})]}),v&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,b.jsxs)(g.Card,{className:"w-full max-w-2xl p-6 border-neon/20 bg-card",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold",children:"Upload Tax Documents"}),(0,b.jsx)(f.Button,{variant:"ghost",size:"sm",onClick:()=>w(!1),children:"✕"})]}),(0,b.jsx)(s,{onUploadComplete:()=>{w(!1),y()}}),(0,b.jsx)("div",{className:"mt-6 pt-6 border-t border-border",children:(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"Supported formats: PDF, JPG, PNG, DOCX (max 10MB)"})})]})})]})}a.s(["default",0,function(){let{user:a,profile:d}=(0,c.useDashboard)();return(0,b.jsx)(t,{user:a,profile:d})}],227536)}];

//# sourceMappingURL=taxu-platform_v0-taxu-landing-page_app_dashboard_documents_page_tsx_83443435._.js.map