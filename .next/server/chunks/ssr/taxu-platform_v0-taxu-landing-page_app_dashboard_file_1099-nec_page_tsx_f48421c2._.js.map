{"version":3,"sources":["../../../../../../taxu-platform/v0-taxu-landing-page/app/dashboard/file/1099-nec/page.tsx","../../../../../../taxu-platform/v0-taxu-landing-page/components/forms/form-1099-nec.tsx","../../../../../../taxu-platform/v0-taxu-landing-page/lib/address-parser.ts"],"sourcesContent":["\"use client\"\n\nimport { useState } from \"react\"\nimport { Form1099NEC } from \"@/components/forms/form-1099-nec\"\nimport { DocumentUpload } from \"@/components/forms/document-upload\"\nimport { DocumentChecklist } from \"@/components/document-checklist\"\nimport { QuickBooksSync } from \"@/components/forms/quickbooks-sync\"\nimport { PayrollIntegration } from \"@/components/payroll-integration\"\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\"\nimport { toast } from \"@/components/ui/use-toast\"\nimport { useDashboard } from \"@/components/dashboard-provider\"\nimport { Alert, AlertDescription } from \"@/components/ui/alert\"\nimport { InfoIcon } from \"lucide-react\"\n\nexport default function File1099NECPage() {\n  const [extractedData, setExtractedData] = useState<any>(null)\n  const [activeTab, setActiveTab] = useState(\"upload\")\n  const [uploadedDocuments, setUploadedDocuments] = useState<\n    Array<{ documentType: string; status: string; fileName: string; data: any }>\n  >([])\n  const [targetDocType, setTargetDocType] = useState<string | undefined>(undefined)\n\n  const { user } = useDashboard()\n  const userId = user?.id || \"\"\n\n  const handleExtractComplete = (data: any, metadata?: any) => {\n    console.log(\"[v0] Extracted data received in 1099-NEC page:\", data)\n\n    if (metadata?.isMultiple && data.contractors && Array.isArray(data.contractors)) {\n      console.log(\"[v0] Processing multiple contractors:\", data.contractors.length)\n\n      const validContractors = data.contractors.filter(\n        (contractor: any) => contractor && contractor.documentType === \"1099-nec\",\n      )\n\n      if (validContractors.length === 0) {\n        toast({\n          title: \"‚ö†Ô∏è No Valid 1099-NEC Documents\",\n          description: \"None of the uploaded documents were recognized as 1099-NEC forms.\",\n          variant: \"destructive\",\n        })\n        return\n      }\n\n      if (validContractors.length !== data.contractors.length) {\n        toast({\n          title: \"‚ö†Ô∏è Some Documents Skipped\",\n          description: `${data.contractors.length - validContractors.length} document(s) were not 1099-NEC forms and were skipped.`,\n          variant: \"destructive\",\n        })\n      }\n\n      setExtractedData({ contractors: validContractors })\n      setActiveTab(\"manual\")\n\n      validContractors.forEach((contractor: any, index: number) => {\n        setUploadedDocuments((prev) => [\n          ...prev,\n          {\n            documentType: \"1099-nec\",\n            status: \"complete\",\n            fileName: contractor.fileName || `contractor-${index + 1}.pdf`,\n            data: contractor,\n          },\n        ])\n      })\n\n      toast({\n        title: \"‚úÖ Multiple Contractors Loaded\",\n        description: `${validContractors.length} contractor document${validContractors.length > 1 ? \"s\" : \"\"} ready for review`,\n      })\n      return\n    }\n\n    if (!data || data.documentType !== \"1099-nec\") {\n      console.error(\"[v0] Invalid extraction data - expected 1099-NEC:\", data)\n      toast({\n        title: \"‚ö†Ô∏è Wrong Document Type\",\n        description: \"This appears to be a different form type. Please upload a 1099-NEC document.\",\n        variant: \"destructive\",\n      })\n      return\n    }\n\n    if (data.isTemplateData === true || metadata?.warning === \"template_data_detected\") {\n      console.log(\"[v0] Template/demo document detected\")\n      toast({\n        title: \"üìã Sample Document Detected\",\n        description:\n          \"This appears to be a demo/sample 1099-NEC. The data has been pre-filled as a starting point. Please update with actual contractor information before submitting.\",\n        duration: 8000,\n      })\n      setExtractedData(data)\n      setActiveTab(\"manual\")\n\n      setUploadedDocuments((prev) => [\n        ...prev,\n        {\n          documentType: \"1099-nec\",\n          status: \"complete\",\n          fileName: metadata?.fileName || \"uploaded-1099-nec.pdf\",\n          data: data,\n        },\n      ])\n      return\n    }\n\n    const hasMinimumData =\n      data.payer?.name &&\n      data.recipient?.name &&\n      (data.compensation !== undefined ||\n        data.nonemployeeCompensation !== undefined ||\n        data.income?.nonemployeeCompensation !== undefined)\n\n    if (!hasMinimumData) {\n      console.error(\"[v0] Incomplete extraction data - missing required fields\")\n      console.log(\"[v0] Payer name:\", data.payer?.name)\n      console.log(\"[v0] Recipient name:\", data.recipient?.name)\n      console.log(\n        \"[v0] Compensation:\",\n        data.compensation || data.nonemployeeCompensation || data.income?.nonemployeeCompensation,\n      )\n\n      toast({\n        title: \"‚ö†Ô∏è Incomplete Extraction\",\n        description:\n          \"Some required fields could not be extracted from the document. The data has been loaded - please complete missing information (especially compensation amount) manually.\",\n        variant: \"destructive\",\n        duration: 8000,\n      })\n      setExtractedData(data)\n      setActiveTab(\"manual\")\n\n      setUploadedDocuments((prev) => [\n        ...prev,\n        {\n          documentType: \"1099-nec\",\n          status: \"complete\",\n          fileName: metadata?.fileName || \"uploaded-1099-nec.pdf\",\n          data: data,\n        },\n      ])\n      return\n    }\n\n    setExtractedData(data)\n    setActiveTab(\"manual\")\n\n    setUploadedDocuments((prev) => [\n      ...prev,\n      {\n        documentType: \"1099-nec\",\n        status: \"complete\",\n        fileName: metadata?.fileName || \"uploaded-1099-nec.pdf\",\n        data: data,\n      },\n    ])\n\n    toast({\n      title: \"‚úÖ Extraction Successful\",\n      description: `Data extracted for ${data.recipient?.name || \"contractor\"}. Review and complete any missing fields before submitting.`,\n    })\n\n    setTargetDocType(undefined)\n  }\n\n  const handleUploadRequired = (docType: string) => {\n    console.log(\"[v0] Upload required for document type:\", docType)\n    setTargetDocType(docType)\n    setActiveTab(\"upload\")\n\n    const docLabels: Record<string, string> = {\n      \"1099-nec\": \"1099-NEC Form\",\n      w9: \"W-9 Contractor Information Form\",\n      contract: \"Independent Contractor Agreement\",\n    }\n\n    toast({\n      title: \"Upload Document\",\n      description: `Please upload ${docLabels[docType] || docType.toUpperCase()}`,\n    })\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-background via-purple-500/5 to-orange-500/5 p-6\">\n      <div className=\"absolute inset-0 bg-[radial-gradient(ellipse_at_top_right,_var(--tw-gradient-stops))] from-purple-500/10 via-transparent to-orange-500/10 pointer-events-none\" />\n\n      <div className=\"relative mx-auto max-w-5xl space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold tracking-tight bg-gradient-to-r from-purple-600 to-orange-600 bg-clip-text text-transparent\">\n              File Form 1099-NEC\n            </h1>\n            <p className=\"text-muted-foreground mt-2\">Report nonemployee compensation for contractors</p>\n          </div>\n        </div>\n\n        <DocumentChecklist\n          filingType=\"1099-nec\"\n          uploadedDocuments={uploadedDocuments}\n          onUploadRequired={handleUploadRequired}\n        />\n\n        <Alert>\n          <InfoIcon className=\"h-4 w-4\" />\n          <AlertDescription>\n            <p className=\"font-medium mb-1\">Required for 1099-NEC E-Filing:</p>\n            <ul className=\"list-disc list-inside text-sm space-y-1\">\n              <li>\n                <strong>1099-NEC Form</strong> - Nonemployee compensation statement (Required)\n              </li>\n              <li>\n                <strong>W-9 Form</strong> - Contractor's taxpayer identification information (Required)\n              </li>\n              <li>\n                <strong>Contractor Agreement</strong> - Independent contractor agreement or contract (Optional but\n                recommended)\n              </li>\n            </ul>\n            <p className=\"mt-2 text-xs text-muted-foreground\">\n              Upload all documents using the tabs below. AI will automatically extract data from tax forms.\n            </p>\n          </AlertDescription>\n        </Alert>\n\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-4 bg-background/50 backdrop-blur-sm\">\n            <TabsTrigger value=\"upload\">üìÑ Upload 1099-NEC</TabsTrigger>\n            <TabsTrigger value=\"payroll\">üíº Payroll Sync</TabsTrigger>\n            <TabsTrigger value=\"quickbooks\">üìä QuickBooks</TabsTrigger>\n            <TabsTrigger value=\"manual\">‚úçÔ∏è Manual Entry</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"upload\" className=\"mt-6\">\n            <DocumentUpload\n              userId={userId}\n              onExtractComplete={handleExtractComplete}\n              formType=\"1099-NEC\"\n              expectedDocType=\"1099-nec\"\n              targetDocumentType={targetDocType}\n              allowMultiple={!targetDocType || targetDocType === \"1099-nec\"}\n              title={\n                targetDocType === \"w9\"\n                  ? \"Upload W-9 Form\"\n                  : targetDocType === \"contract\"\n                    ? \"Upload Contractor Agreement\"\n                    : \"Upload 1099-NEC Documents\"\n              }\n              description={\n                targetDocType === \"w9\"\n                  ? \"Upload the W-9 form with contractor taxpayer information\"\n                  : targetDocType === \"contract\"\n                    ? \"Upload independent contractor agreement or service contract\"\n                    : \"Upload 1099-NEC forms and supporting documents (W-9, contracts)\"\n              }\n            />\n          </TabsContent>\n\n          <TabsContent value=\"payroll\" className=\"mt-6\">\n            <PayrollIntegration formType=\"1099-NEC\" />\n          </TabsContent>\n\n          <TabsContent value=\"quickbooks\" className=\"mt-6\">\n            <QuickBooksSync onSyncComplete={handleExtractComplete} formType=\"1099-NEC\" />\n          </TabsContent>\n\n          <TabsContent value=\"manual\" className=\"mt-6\">\n            <Form1099NEC userId={userId} extractedData={extractedData} />\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  )\n}\n","\"use client\"\nimport type React from \"react\"\nimport { useState, useEffect } from \"react\"\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Label } from \"@/components/ui/label\"\nimport { useToast } from \"@/hooks/use-toast\"\nimport {\n  Loader2,\n  Trash2,\n  CheckCircle2,\n  AlertCircle,\n  Lock,\n  Sparkles,\n  FileText,\n  ArrowLeft,\n  ArrowRight,\n  Send,\n} from \"lucide-react\"\nimport { useRouter } from \"next/navigation\"\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\"\nimport { parseAddress } from \"@/lib/address-parser\"\nimport { parseName } from \"@/lib/name-parser\"\nimport { PenaltyAbatementDialog } from \"@/components/penalty-abatement-dialog\"\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\"\nimport { ProgressStepper } from \"@/components/ui/progress-stepper\"\nimport { FilingReviewSection } from \"@/components/filing-review-section\"\nimport { FilingProgressDialog } from \"@/components/filing-progress-dialog\"\n\ninterface Contractor {\n  id: string\n  firstName: string\n  middleInitial: string\n  lastName: string\n  ssn: string\n  ein: string\n  address: string\n  city: string\n  state: string\n  zipCode: string\n  compensation: string\n  email: string\n  accountNumber: string\n  secondTinNotification: boolean\n  directSales5000Plus: boolean\n  federalTaxWithheld: string\n  stateTaxWithheld: string\n  statePayerNumber: string\n  stateIncome: string\n  isVoid: boolean\n  isCorrected: boolean\n  isFatcaFiling: boolean\n}\n\ninterface Form1099NECProps {\n  userId: string\n  extractedData?: any // Added extractedData prop\n}\n\nexport function Form1099NEC({ userId, extractedData }: Form1099NECProps) {\n  const [contractors, setContractors] = useState<Contractor[]>([\n    {\n      id: \"1\",\n      firstName: \"\",\n      middleInitial: \"\",\n      lastName: \"\",\n      ssn: \"\",\n      ein: \"\",\n      address: \"\",\n      city: \"\",\n      state: \"\",\n      zipCode: \"\",\n      compensation: \"\",\n      email: \"\",\n      accountNumber: \"\",\n      secondTinNotification: false,\n      directSales5000Plus: false,\n      federalTaxWithheld: \"\",\n      stateTaxWithheld: \"\",\n      statePayerNumber: \"\",\n      stateIncome: \"\",\n      isVoid: false,\n      isCorrected: false,\n      isFatcaFiling: false,\n    },\n  ])\n  const [isSubmitting, setIsSubmitting] = useState(false)\n  const [validationErrors, setValidationErrors] = useState<Record<string, string>>({})\n  const [isValidating, setIsValidating] = useState(false)\n  const [validationResults, setValidationResults] = useState<any>(null)\n  const [showPenaltyDialog, setShowPenaltyDialog] = useState(false)\n  const [currentFormStep, setCurrentFormStep] = useState(1) // 1 = Fill Form, 2 = Review\n  const [showProgressDialog, setShowProgressDialog] = useState(false)\n  const [filingProgress, setFilingProgress] = useState(0)\n  const [isUploading, setIsUploading] = useState(false)\n  const [uploadingContractorId, setUploadingContractorId] = useState<string | null>(null)\n  const { toast } = useToast()\n  const router = useRouter()\n\n  const currentYear = new Date().getFullYear()\n  const taxYear = currentYear - 1 // 1099-NEC is for the previous year\n\n  const canEfile = (year: number) => {\n    const yearsBack = currentYear - year\n    // 1099-NEC e-filing deadline is January 31st\n    // Only current year (previous calendar year) can be e-filed\n    return yearsBack === 1\n  }\n\n  const isPaperFilingRequired = !canEfile(taxYear)\n\n  const addContractor = () => {\n    setContractors([\n      ...contractors,\n      {\n        id: Date.now().toString(),\n        firstName: \"\",\n        middleInitial: \"\",\n        lastName: \"\",\n        ssn: \"\",\n        ein: \"\",\n        address: \"\",\n        city: \"\",\n        state: \"\",\n        zipCode: \"\",\n        compensation: \"\",\n        email: \"\",\n        accountNumber: \"\",\n        secondTinNotification: false,\n        directSales5000Plus: false,\n        federalTaxWithheld: \"\",\n        stateTaxWithheld: \"\",\n        statePayerNumber: \"\",\n        stateIncome: \"\",\n        isVoid: false,\n        isCorrected: false,\n        isFatcaFiling: false,\n      },\n    ])\n  }\n\n  const removeContractor = (id: string) => {\n    setContractors(contractors.filter((c) => c.id !== id))\n  }\n\n  const updateContractor = (id: string, field: keyof Contractor, value: string) => {\n    let formattedValue = value\n    if (field === \"ssn\") {\n      formattedValue = formatSSN(value)\n    } else if (field === \"ein\") {\n      formattedValue = formatEIN(value)\n    } else if (field === \"state\") {\n      formattedValue = value.toUpperCase()\n    } else if (field === \"federalTaxWithheld\" || field === \"stateTaxWithheld\" || field === \"stateIncome\") {\n      // Ensure currency fields only accept numbers and decimals\n      formattedValue = value.replace(/[^0-9.]/g, \"\")\n    } else if (\n      field === \"secondTinNotification\" ||\n      field === \"directSales5000Plus\" ||\n      field === \"isVoid\" ||\n      field === \"isCorrected\" ||\n      field === \"isFatcaFiling\"\n    ) {\n      // Handle boolean checkbox values\n      formattedValue = (value === \"true\").toString()\n    }\n\n    if (field === \"city\" && value.includes(\" \")) {\n      const parsed = parseAddress(value)\n      if (parsed.city && parsed.state && parsed.zipCode) {\n        setContractors(\n          contractors.map((c) =>\n            c.id === id ? { ...c, city: parsed.city, state: parsed.state, zipCode: parsed.zipCode } : c,\n          ),\n        )\n        return\n      }\n    }\n\n    if (field === \"lastName\" && value.includes(\" \")) {\n      const parsed = parseName(\"\", value)\n      if (parsed.middleInitial && parsed.lastName) {\n        setContractors(\n          contractors.map((c) =>\n            c.id === id ? { ...c, middleInitial: parsed.middleInitial, lastName: parsed.lastName } : c,\n          ),\n        )\n        return\n      }\n    }\n\n    setContractors(contractors.map((c) => (c.id === id ? { ...c, [field]: formattedValue } : c)))\n\n    if (validationErrors[`${id}-${field}`]) {\n      setValidationErrors({ ...validationErrors, [`${id}-${field}`]: \"\" })\n    }\n  }\n\n  const validateForm = () => {\n    const errors: Record<string, string> = {}\n\n    contractors.forEach((contractor) => {\n      if (!contractor.firstName.trim()) {\n        errors[`${contractor.id}-firstName`] = \"First name is required\"\n      }\n      if (!contractor.lastName.trim()) {\n        errors[`${contractor.id}-lastName`] = \"Last name is required\"\n      }\n      if (!contractor.ssn && !contractor.ein) {\n        errors[`${contractor.id}-ssn`] = \"Either SSN or EIN is required\"\n      }\n      if (contractor.ssn && !validateSSN(contractor.ssn)) {\n        errors[`${contractor.id}-ssn`] = \"Invalid SSN format\"\n      }\n      if (contractor.ein && !validateEIN(contractor.ein)) {\n        errors[`${contractor.id}-ein`] = \"Invalid EIN format\"\n      }\n      if (!contractor.address.trim()) {\n        errors[`${contractor.id}-address`] = \"Address is required\"\n      }\n      if (!contractor.city.trim()) {\n        errors[`${contractor.id}-city`] = \"City is required\"\n      }\n      if (!contractor.state || !US_STATES.includes(contractor.state)) {\n        errors[`${contractor.id}-state`] = \"Valid state is required\"\n      }\n      if (!contractor.zipCode || !/^\\d{5}(-\\d{4})?$/.test(contractor.zipCode)) {\n        errors[`${contractor.id}-zipCode`] = \"Valid ZIP code is required\"\n      }\n      const compensation = Number.parseFloat(contractor.compensation)\n      if (!contractor.compensation || isNaN(compensation) || compensation < 600) {\n        errors[`${contractor.id}-compensation`] = \"Compensation must be at least $600\"\n      }\n\n      // Optional field validations\n      const federalTaxWithheld = Number.parseFloat(contractor.federalTaxWithheld)\n      if (contractor.federalTaxWithheld && (isNaN(federalTaxWithheld) || federalTaxWithheld < 0)) {\n        errors[`${contractor.id}-federalTaxWithheld`] = \"Federal tax withheld must be a non-negative number\"\n      }\n\n      const stateTaxWithheld = Number.parseFloat(contractor.stateTaxWithheld)\n      if (contractor.stateTaxWithheld && (isNaN(stateTaxWithheld) || stateTaxWithheld < 0)) {\n        errors[`${contractor.id}-stateTaxWithheld`] = \"State tax withheld must be a non-negative number\"\n      }\n\n      const stateIncome = Number.parseFloat(contractor.stateIncome)\n      if (contractor.stateIncome && (isNaN(stateIncome) || stateIncome < 0)) {\n        errors[`${contractor.id}-stateIncome`] = \"State income must be a non-negative number\"\n      }\n    })\n\n    setValidationErrors(errors)\n    return Object.keys(errors).length === 0\n  }\n\n  const handleAIValidation = async () => {\n    setIsValidating(true)\n    setValidationResults(null)\n\n    try {\n      const response = await fetch(\"/api/validate-form\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          formType: \"1099-nec\",\n          formData: { contractors },\n        }),\n      })\n\n      const data = await response.json()\n\n      if (data.success && data.validation) {\n        setValidationResults(data.validation)\n\n        const systemWarning = data.validation.warnings?.find((w: any) => w.field === \"system\")\n        const isAIUnavailable = systemWarning && systemWarning.message.includes(\"temporarily unavailable\")\n\n        toast({\n          title: isAIUnavailable ? \"Basic Validation Complete\" : \"AI Validation Complete\",\n          description: `Found ${data.validation.errors.length} errors, ${data.validation.warnings.length} warnings, ${data.validation.suggestions.length} suggestions`,\n        })\n      } else {\n        throw new Error(data.error || \"Validation failed\")\n      }\n    } catch (error) {\n      toast({\n        title: \"Validation Failed\",\n        description: error instanceof Error ? error.message : \"An error occurred\",\n        variant: \"destructive\",\n      })\n    } finally {\n      setIsValidating(false)\n    }\n  }\n\n  const handleContractorFileUpload = async (contractorId: string, file: File) => {\n    setUploadingContractorId(contractorId)\n\n    try {\n      // Upload file to blob storage\n      const uploadFormData = new FormData()\n      uploadFormData.append(\"file\", file)\n\n      const uploadResponse = await fetch(\"/api/upload\", {\n        method: \"POST\",\n        body: uploadFormData,\n      })\n\n      if (!uploadResponse.ok) throw new Error(\"Upload failed\")\n\n      const { url } = await uploadResponse.json()\n\n      // Extract data from document\n      const extractResponse = await fetch(\"/api/filing/extract-document\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ fileId: url }),\n      })\n\n      const extractData = await extractResponse.json()\n\n      if (extractData.success && extractData.data.documentType === \"1099-nec\") {\n        const extracted = extractData.data\n\n        // Parse recipient name\n        const recipientName = extracted.recipient?.name || \"\"\n        const nameParts = recipientName.split(\" \")\n        const firstName = nameParts[0] || \"\"\n        const lastName = nameParts.length > 1 ? nameParts[nameParts.length - 1] : \"\"\n        const middleInitial = nameParts.length > 2 ? nameParts[1].charAt(0).toUpperCase() : \"\"\n\n        // Parse recipient address\n        const recipientAddress = extracted.recipient?.address || \"\"\n        const parseAddress = (addr: string) => {\n          const parts = addr.split(\",\").map((p) => p.trim())\n          return {\n            street: parts[0] || \"\",\n            city: parts[1] || \"\",\n            state: parts[2] || \"\",\n            zip: parts[3] || \"\",\n          }\n        }\n        const recipientParsed = parseAddress(recipientAddress)\n\n        // Update only the specific contractor\n        setContractors((prev) =>\n          prev.map((c) =>\n            c.id === contractorId\n              ? {\n                  ...c,\n                  firstName,\n                  middleInitial,\n                  lastName,\n                  ssn: extracted.recipient?.ssn || extracted.recipient?.tin || \"\",\n                  ein: extracted.recipient?.ein || \"\",\n                  address: recipientParsed.street,\n                  city: recipientParsed.city,\n                  state: recipientParsed.state,\n                  zipCode: recipientParsed.zip,\n                  compensation:\n                    extracted.nonemployeeCompensation?.toString() || extracted.compensation?.toString() || \"\",\n                  email: extracted.recipient?.email || \"\",\n                  // New fields extracted from document (if available)\n                  federalTaxWithheld: extracted.federalTaxWithheld?.toString() || \"\",\n                  stateTaxWithheld: extracted.stateTaxWithheld?.toString() || \"\",\n                  stateIncome: extracted.stateIncome?.toString() || \"\",\n                  directSales5000Plus: extracted.directSales5000Plus || false,\n                  isCorrected: extracted.isCorrected || false,\n                  isVoid: extracted.isVoid || false,\n                  secondTinNotification: extracted.secondTinNotification || false,\n                  accountNumber: extracted.accountNumber || \"\",\n                }\n              : c,\n          ),\n        )\n\n        toast({\n          title: \"‚ú® Contractor Data Auto-Filled\",\n          description: `${firstName} ${lastName}'s information has been extracted. Please review before submitting.`,\n        })\n      } else {\n        throw new Error(\"Could not extract 1099-NEC data from document\")\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Extraction Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      })\n    } finally {\n      setUploadingContractorId(null)\n    }\n  }\n\n  const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n\n    setIsUploading(true)\n\n    try {\n      const uploadFormData = new FormData()\n      uploadFormData.append(\"file\", file)\n\n      const uploadResponse = await fetch(\"/api/upload\", {\n        method: \"POST\",\n        body: uploadFormData,\n      })\n\n      if (!uploadResponse.ok) throw new Error(\"Upload failed\")\n\n      const { url } = await uploadResponse.json()\n\n      const extractResponse = await fetch(\"/api/filing/extract-document\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ fileId: url }),\n      })\n\n      const extractData = await extractResponse.json()\n\n      if (extractData.success && extractData.data.documentType === \"1099-nec\") {\n        toast({\n          title: \"‚ú® AI Extraction Complete\",\n          description: \"Your 1099-NEC has been automatically filled. Please review the data.\",\n        })\n        // Auto-fill logic here\n        // NOTE: The extracted data here is for the entire form, not per contractor.\n        // The `useEffect` hook handles processing `extractedData` for initial form population.\n      } else {\n        throw new Error(\"Could not extract 1099-NEC data from document\")\n      }\n    } catch (error: any) {\n      toast({\n        title: \"Extraction Failed\",\n        description: error.message,\n        variant: \"destructive\",\n      })\n    } finally {\n      setIsUploading(false)\n    }\n  }\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n\n    console.log(\"[v0] handleSubmit called, currentFormStep:\", currentFormStep)\n\n    if (currentFormStep === 1) {\n      if (!validateForm()) {\n        toast({\n          title: \"Validation Error\",\n          description: \"Please fix the errors in the form before continuing\",\n          variant: \"destructive\",\n        })\n        return\n      }\n\n      if (!validationResults) {\n        await handleAIValidation()\n      }\n      setCurrentFormStep(2)\n      window.scrollTo({ top: 0, behavior: \"smooth\" })\n      return\n    }\n\n    console.log(\"[v0] Attempting to submit to IRS...\")\n    console.log(\"[v0] Validation results:\", validationResults)\n\n    if (!validationResults) {\n      toast({\n        title: \"Please Validate Form\",\n        description: \"Click 'AI Validate Form' before submitting\",\n        variant: \"destructive\",\n      })\n      await handleAIValidation()\n      return\n    }\n\n    if (validationResults.errors && validationResults.errors.length > 0) {\n      const errorMessages = validationResults.errors.map((e: any) => e.message || e.field).join(\", \")\n      toast({\n        title: \"Please Fix Errors\",\n        description: `Your form has validation errors: ${errorMessages.substring(0, 100)}...`,\n        variant: \"destructive\",\n      })\n      setCurrentFormStep(1)\n      return\n    }\n\n    if (!validateForm()) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Please fix the errors in the form\",\n        variant: \"destructive\",\n      })\n      setCurrentFormStep(1)\n      return\n    }\n\n    setIsSubmitting(true)\n    setShowProgressDialog(true)\n    setFilingProgress(1)\n\n    console.log(\"[v0] Starting IRS submission...\")\n\n    try {\n      console.log(\"[v0] Step 1/3: Authenticating with IRS e-filing system\")\n      await new Promise((resolve) => setTimeout(resolve, 1500))\n      setFilingProgress(2)\n\n      console.log(\"[v0] Step 2/3: Verifying business entity with IRS\")\n      await new Promise((resolve) => setTimeout(resolve, 1500))\n      setFilingProgress(3)\n\n      console.log(\"[v0] Step 3/3: Submitting 1099-NEC forms to IRS\")\n      console.log(\"[v0] Calling /api/filing/submit-1099...\")\n      const response = await fetch(\"/api/filing/submit-1099\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          userId,\n          taxYear: new Date().getFullYear() - 1,\n          contractors: contractors.map((c) => ({\n            firstName: c.firstName,\n            middleInitial: c.middleInitial,\n            lastName: c.lastName,\n            ssn: c.ssn.replace(/\\D/g, \"\"),\n            ein: c.ein.replace(/\\D/g, \"\"),\n            email: c.email,\n            address: {\n              street: c.address,\n              city: c.city,\n              state: c.state,\n              zipCode: c.zipCode,\n            },\n            compensation: Number.parseFloat(c.compensation),\n            accountNumber: c.accountNumber,\n            secondTinNotification: c.secondTinNotification,\n            directSales5000Plus: c.directSales5000Plus,\n            federalTaxWithheld: Number.parseFloat(c.federalTaxWithheld || \"0\"),\n            stateTaxWithheld: Number.parseFloat(c.stateTaxWithheld || \"0\"),\n            statePayerNumber: c.statePayerNumber,\n            stateIncome: Number.parseFloat(c.stateIncome || \"0\"),\n            isVoid: c.isVoid,\n            isCorrected: c.isCorrected,\n            isFatcaFiling: c.isFatcaFiling,\n          })),\n        }),\n      })\n\n      console.log(\"[v0] API response status:\", response.status)\n      const data = await response.json()\n      console.log(\"[v0] API response data:\", data)\n\n      await new Promise((resolve) => setTimeout(resolve, 1000))\n\n      if (data.isDemoMode) {\n        toast({\n          title: \"Demo Mode Restriction\",\n          description: data.error,\n          variant: \"destructive\",\n        })\n        setIsSubmitting(false)\n        setShowProgressDialog(false)\n        setFilingProgress(0)\n        return\n      }\n\n      if (data.success) {\n        console.log(\"[v0] ‚úÖ 1099-NEC SUBMITTED SUCCESSFULLY!\")\n\n        setFilingProgress(4)\n\n        toast({\n          title: \"1099-NEC Successfully Submitted to IRS\",\n          description: `Submission IDs: ${data.submissionIds?.join(\", \") || \"N/A\"}. The IRS will process your filing within 24-48 hours.`,\n          duration: 5000,\n        })\n\n        localStorage.removeItem(\"1099_draft\")\n\n        setTimeout(() => {\n          router.push(data.filingId ? `/dashboard/filing/${data.filingId}` : \"/dashboard/filing\")\n        }, 3000)\n      } else {\n        setFilingProgress(0)\n        setShowProgressDialog(false)\n\n        throw new Error(data.error || \"Failed to submit filing\")\n      }\n    } catch (error) {\n      console.error(\"[v0] SUBMISSION ERROR:\", error)\n\n      setShowProgressDialog(false)\n      setFilingProgress(0)\n\n      toast({\n        title: \"Submission Failed\",\n        description: error instanceof Error ? error.message : \"An error occurred\",\n        variant: \"destructive\",\n      })\n    } finally {\n      setIsSubmitting(false)\n    }\n  }\n\n  const formSteps = [\n    { id: \"fill\", label: \"Fill Form\", sublabel: \"Enter Information\" },\n    { id: \"review\", label: \"Review & Submit\", sublabel: \"Verify Details\" },\n  ]\n\n  const progressSteps = [\n    {\n      id: \"auth\",\n      title: \"Authenticating\",\n      description: \"Securely connecting to IRS e-filing system\",\n      icon: \"üîê\",\n    },\n    {\n      id: \"business\",\n      title: \"Verifying business entity\",\n      description: \"Setting up your business profile with the IRS\",\n      icon: \"üè¢\",\n    },\n    {\n      id: \"submit\",\n      title: \"Submitting 1099-NEC forms\",\n      description: \"Transmitting contractor payment data to the IRS\",\n      icon: \"üìÑ\",\n    },\n  ]\n\n  const reviewSections = contractors.map((contractor, index) => {\n    const fields = [\n      {\n        label: \"Full Name\",\n        value: `${contractor.firstName} ${contractor.middleInitial ? contractor.middleInitial + \". \" : \"\"}${contractor.lastName}`,\n      },\n      { label: \"Social Security Number\", value: contractor.ssn, sensitive: true },\n      { label: \"EIN (if business)\", value: contractor.ein, sensitive: true },\n      { label: \"Email\", value: contractor.email || \"Not provided\" },\n      {\n        label: \"Address\",\n        value: contractor.address.includes(\",\")\n          ? contractor.address\n          : `${contractor.address}, ${contractor.city}, ${contractor.state} ${contractor.zipCode}`,\n      },\n      { label: \"Nonemployee Compensation\", value: `$${Number.parseFloat(contractor.compensation || \"0\").toFixed(2)}` },\n    ]\n\n    // Conditionally add optional fields to review section if they have values\n    if (contractor.accountNumber) {\n      fields.push({ label: \"Account Number\", value: contractor.accountNumber })\n    }\n    if (contractor.directSales5000Plus) {\n      fields.push({ label: \"Direct Sales (Box 2)\", value: \"Yes\" })\n    }\n    if (Number.parseFloat(contractor.federalTaxWithheld || \"0\") > 0) {\n      fields.push({\n        label: \"Federal Tax Withheld (Box 4)\",\n        value: `$${Number.parseFloat(contractor.federalTaxWithheld).toFixed(2)}`,\n      })\n    }\n    if (Number.parseFloat(contractor.stateTaxWithheld || \"0\") > 0) {\n      fields.push({\n        label: \"State Tax Withheld (Box 5)\",\n        value: `$${Number.parseFloat(contractor.stateTaxWithheld).toFixed(2)}`,\n      })\n    }\n    if (contractor.statePayerNumber) {\n      fields.push({ label: \"State/Payer's State No. (Box 6)\", value: contractor.statePayerNumber })\n    }\n    if (Number.parseFloat(contractor.stateIncome || \"0\") > 0) {\n      fields.push({ label: \"State Income (Box 7)\", value: `$${Number.parseFloat(contractor.stateIncome).toFixed(2)}` })\n    }\n    if (contractor.isVoid) {\n      fields.push({ label: \"Form Status\", value: \"VOID\" })\n    }\n    if (contractor.isCorrected) {\n      fields.push({ label: \"Form Status\", value: \"CORRECTED\" })\n    }\n    if (contractor.secondTinNotification) {\n      fields.push({ label: \"2nd TIN Notification\", value: \"Yes\" })\n    }\n    if (contractor.isFatcaFiling) {\n      fields.push({ label: \"FATCA Filing\", value: \"Yes\" })\n    }\n\n    return {\n      title: `Contractor ${index + 1}: ${contractor.firstName} ${contractor.lastName}`,\n      fields: fields,\n    }\n  })\n\n  useEffect(() => {\n    if (extractedData) {\n      console.log(\"[v0] Auto-filling 1099-NEC form with extracted data:\", extractedData)\n\n      if (extractedData.isTemplateData === true) {\n        console.log(\"[v0] Detected template data in form initialization, showing warning.\")\n        toast({\n          title: \"‚ö†Ô∏è Template Document Detected\",\n          description:\n            \"The uploaded document appears to be a sample/demo form. Please upload real tax documents with actual taxpayer information. Data may be inaccurate.\",\n          variant: \"warning\",\n        })\n      }\n\n      // Check if extractedData.contractors is an array and contains multiple contractor entries\n      if (extractedData.contractors && Array.isArray(extractedData.contractors)) {\n        console.log(\"[v0] Processing multiple contractors:\", extractedData.contractors.length)\n\n        const newContractors = extractedData.contractors\n          .filter((contractorData: any) => {\n            if (contractorData.isTemplateData === true) {\n              console.log(\"[v0] Including template contractor data for testing:\", contractorData.recipient?.name)\n              toast({\n                title: \"‚ö†Ô∏è Template Contractor Data Included\",\n                description: `Contractor ${contractorData.recipient?.name || \"Unknown\"} appears to be from a template. Data accuracy is not guaranteed.`,\n                variant: \"warning\",\n              })\n            }\n            // Ensure we only process 1099-NEC documents if specified by the extractor\n            return contractorData.documentType === \"1099-nec\"\n          })\n          .map((contractorData: any, index: number) => {\n            const recipientName = contractorData.recipient?.name || \"\"\n            const nameParts = recipientName.split(\" \")\n            const firstName = nameParts[0] || \"\"\n            const lastName = nameParts.length > 1 ? nameParts[nameParts.length - 1] : \"\"\n            const middleInitial = nameParts.length > 2 ? nameParts[1].charAt(0).toUpperCase() : \"\"\n\n            // Extract address parts\n            const street = contractorData.recipient?.address || \"\"\n            const city = contractorData.recipient?.city || \"\"\n            const state = contractorData.recipient?.state || \"\"\n            const zipCode = contractorData.recipient?.zipCode || \"\"\n\n            return {\n              id: `${Date.now()}-${index}`, // Unique ID for each contractor\n              firstName,\n              middleInitial,\n              lastName,\n              ssn: contractorData.recipient?.ssn || contractorData.recipient?.tin || \"\",\n              ein: contractorData.recipient?.ein || \"\",\n              address: street,\n              city: city,\n              state: state,\n              zipCode: zipCode,\n              compensation:\n                contractorData.income?.nonemployeeCompensation?.toString() ||\n                contractorData.nonemployeeCompensation?.toString() ||\n                contractorData.compensation?.toString() ||\n                \"\",\n              email: contractorData.recipient?.email || \"\",\n              // New fields extracted from document (if available)\n              accountNumber: contractorData.accountNumber || \"\",\n              secondTinNotification: contractorData.secondTinNotification || false,\n              directSales5000Plus: contractorData.directSales5000Plus || false,\n              federalTaxWithheld: contractorData.federalTaxWithheld?.toString() || \"\",\n              stateTaxWithheld: contractorData.stateTaxWithheld?.toString() || \"\",\n              statePayerNumber: contractorData.statePayerNumber || \"\",\n              stateIncome: contractorData.stateIncome?.toString() || \"\",\n              isVoid: contractorData.isVoid || false,\n              isCorrected: contractorData.isCorrected || false,\n              isFatcaFiling: contractorData.isFatcaFiling || false,\n            }\n          })\n\n        if (newContractors.length === 0) {\n          toast({\n            title: \"‚ö†Ô∏è No Valid 1099-NEC Forms\",\n            description: \"The uploaded documents are not 1099-NEC forms. Please upload valid 1099-NEC tax documents.\",\n            variant: \"destructive\",\n          })\n          return\n        }\n\n        setContractors(newContractors)\n\n        toast({\n          title: \"‚ú® Multiple Contractors Auto-Filled\",\n          description: `${newContractors.length} contractor form${newContractors.length > 1 ? \"s\" : \"\"} populated. Please review before submitting.`,\n        })\n        return\n      }\n\n      // Handle single contractor extraction if not an array of contractors\n      const extracted = extractedData\n\n      const recipientName = extracted.recipient?.name || \"\"\n      const nameParts = recipientName.split(\" \")\n      const firstName = nameParts[0] || \"\"\n      const lastName = nameParts.length > 1 ? nameParts[nameParts.length - 1] : \"\"\n      const middleInitial = nameParts.length > 2 ? nameParts[1].charAt(0).toUpperCase() : \"\"\n\n      const newContractor: Contractor = {\n        id: Date.now().toString(),\n        firstName,\n        middleInitial,\n        lastName,\n        ssn: extracted.recipient?.ssn || extracted.recipient?.tin || \"\",\n        ein: extracted.recipient?.ein || \"\",\n        address: extracted.recipient?.street || \"\",\n        city: extracted.recipient?.city || \"\",\n        state: extracted.recipient?.state || \"\",\n        zipCode: extracted.recipient?.zipCode || \"\",\n        compensation:\n          extracted.income?.nonemployeeCompensation?.toString() ||\n          extracted.nonemployeeCompensation?.toString() ||\n          extracted.compensation?.toString() ||\n          \"\",\n        email: extracted.recipient?.email || \"\",\n        // New fields extracted from document (if available)\n        accountNumber: extracted.accountNumber || \"\",\n        secondTinNotification: extracted.secondTinNotification || false,\n        directSales5000Plus: extracted.directSales5000Plus || false,\n        federalTaxWithheld: extracted.federalTaxWithheld?.toString() || \"\",\n        stateTaxWithheld: extracted.stateTaxWithheld?.toString() || \"\",\n        statePayerNumber: extracted.statePayerNumber || \"\",\n        stateIncome: extracted.stateIncome?.toString() || \"\",\n        isVoid: extracted.isVoid || false,\n        isCorrected: extracted.isCorrected || false,\n        isFatcaFiling: extracted.isFatcaFiling || false,\n      }\n\n      setContractors((prev) => {\n        const hasEmptyContractor = prev.some((c) => !c.firstName && !c.lastName && !c.ssn && !c.compensation)\n\n        if (hasEmptyContractor) {\n          // Replace the first empty contractor\n          const updatedContractors = [...prev]\n          const emptyIndex = updatedContractors.findIndex(\n            (c) => !c.firstName && !c.lastName && !c.ssn && !c.compensation,\n          )\n          updatedContractors[emptyIndex] = newContractor\n          return updatedContractors\n        } else {\n          // Append as a new contractor\n          return [...prev, newContractor]\n        }\n      })\n\n      toast({\n        title: \"‚ú® Contractor Auto-Filled\",\n        description: `${firstName} ${lastName}'s information has been extracted. Please review before submitting.`,\n      })\n    }\n  }, [extractedData])\n\n  const US_STATES = [\n    \"AL\",\n    \"AK\",\n    \"AZ\",\n    \"AR\",\n    \"CA\",\n    \"CO\",\n    \"CT\",\n    \"DE\",\n    \"FL\",\n    \"GA\",\n    \"HI\",\n    \"ID\",\n    \"IL\",\n    \"IN\",\n    \"IA\",\n    \"KS\",\n    \"KY\",\n    \"LA\",\n    \"ME\",\n    \"MD\",\n    \"MA\",\n    \"MI\",\n    \"MN\",\n    \"MS\",\n    \"MO\",\n    \"MT\",\n    \"NE\",\n    \"NV\",\n    \"NH\",\n    \"NJ\",\n    \"NM\",\n    \"NY\",\n    \"NC\",\n    \"ND\",\n    \"OH\",\n    \"OK\",\n    \"OR\",\n    \"PA\",\n    \"RI\",\n    \"SC\",\n    \"SD\",\n    \"TN\",\n    \"TX\",\n    \"UT\",\n    \"VT\",\n    \"VA\",\n    \"WA\",\n    \"WV\",\n    \"WI\",\n    \"WY\",\n  ]\n\n  const formatSSN = (value: string) => {\n    const numbers = value.replace(/\\D/g, \"\")\n    if (numbers.length <= 3) return numbers\n    if (numbers.length <= 5) return `${numbers.slice(0, 3)}-${numbers.slice(3)}`\n    return `${numbers.slice(0, 3)}-${numbers.slice(3, 5)}-${numbers.slice(5, 9)}`\n  }\n\n  const formatEIN = (value: string) => {\n    const numbers = value.replace(/\\D/g, \"\")\n    if (numbers.length <= 2) return numbers\n    return `${numbers.slice(0, 2)}-${numbers.slice(2, 9)}`\n  }\n\n  const validateSSN = (ssn: string) => {\n    const numbers = ssn.replace(/\\D/g, \"\")\n    return numbers.length === 9\n  }\n\n  const validateEIN = (ein: string) => {\n    const numbers = ein.replace(/\\D/g, \"\")\n    return numbers.length === 9\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <ProgressStepper steps={formSteps} currentStep={currentFormStep} />\n\n      {currentFormStep === 2 ? (\n        <>\n          <FilingReviewSection sections={reviewSections} formType=\"1099-NEC\" />\n\n          <div className=\"flex gap-4 pt-6\">\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => setCurrentFormStep(1)}\n              className=\"flex-1\"\n              disabled={isSubmitting}\n            >\n              <ArrowLeft className=\"mr-2 h-4 w-4\" />\n              Back to Edit\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={isSubmitting}\n              className=\"flex-1 bg-gradient-to-r from-[#005ea2] to-[#162e51] hover:opacity-90 text-white text-lg py-6\"\n            >\n              {isSubmitting && <Loader2 className=\"mr-2 h-5 w-5 animate-spin\" />}\n              <Send className=\"mr-2 h-5 w-5\" />\n              Submit to IRS\n            </Button>\n          </div>\n        </>\n      ) : (\n        <>\n          <Card className=\"relative overflow-hidden border-2 border-purple-500/20 bg-gradient-to-br from-background via-background to-purple-500/5\">\n            <div className=\"absolute inset-0 bg-gradient-to-br from-purple-500/5 via-transparent to-orange-500/5 pointer-events-none\" />\n\n            <CardHeader className=\"relative\">\n              <div className=\"flex items-center justify-between gap-4 mb-4\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => router.push(\"/dashboard/filing/new\")}\n                  className=\"hover:scale-105 transition-transform bg-transparent\"\n                >\n                  <ArrowLeft className=\"h-4 w-4 mr-2\" />\n                  Back\n                </Button>\n\n                <div className=\"relative\">\n                  <input\n                    type=\"file\"\n                    accept=\".pdf,.jpg,.jpeg,.png\"\n                    onChange={handleFileUpload}\n                    className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10\"\n                    disabled={isUploading}\n                  />\n                  <Button\n                    type=\"button\"\n                    size=\"sm\"\n                    disabled={isUploading}\n                    className=\"relative overflow-hidden bg-gradient-to-r from-purple-600 via-purple-500 to-pink-500 hover:from-purple-700 hover:via-purple-600 hover:to-pink-600 text-white font-semibold shadow-lg hover:shadow-xl hover:shadow-purple-500/50 transition-all duration-300 border-0 group\"\n                  >\n                    {/* Shimmer effect overlay */}\n                    <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-200%] group-hover:translate-x-[200%] transition-transform duration-1000\" />\n\n                    {isUploading ? (\n                      <>\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        Extracting...\n                      </>\n                    ) : (\n                      <>\n                        <Sparkles className=\"h-4 w-4 mr-2 animate-pulse\" />\n                        Upload 1099-NEC (AI Extract)\n                      </>\n                    )}\n                  </Button>\n                </div>\n              </div>\n\n              <CardTitle className=\"text-2xl bg-gradient-to-r from-purple-600 to-orange-600 bg-clip-text text-transparent\">\n                Form 1099-NEC - Nonemployee Compensation\n              </CardTitle>\n              <CardDescription>\n                <div className=\"space-y-4 mt-3\">\n                  <div className=\"flex items-center gap-3\">\n                    <span className=\"text-sm\">Report contractor payments for</span>\n                    <Select\n                      value={taxYear.toString()}\n                      onValueChange={(value) => {\n                        /* handle year change if needed */\n                      }}\n                    >\n                      <SelectTrigger className=\"w-[120px] h-8 bg-background/80 border-purple-500/20\">\n                        <SelectValue placeholder=\"Select year\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {Array.from({ length: 10 }, (_, i) => currentYear - i - 1).map((year) => (\n                          <SelectItem key={year} value={year.toString()}>\n                            {year}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  {isPaperFilingRequired ? (\n                    <Alert className=\"bg-orange-500/10 border-orange-500/20\">\n                      <AlertCircle className=\"h-4 w-4 text-orange-600\" />\n                      <AlertTitle className=\"text-orange-600 font-semibold\">\n                        Late 1099-NEC Filing - Paper Filing Required\n                      </AlertTitle>\n                      <AlertDescription className=\"text-sm space-y-2 mt-2\">\n                        <p>\n                          <strong>Tax year {taxYear}</strong> is beyond the IRS e-filing deadline (January 31st).\n                        </p>\n                        <p>You'll need to:</p>\n                        <ul className=\"list-disc list-inside space-y-1 ml-2\">\n                          <li>Complete paper 1099-NEC forms</li>\n                          <li>Submit via mail to the IRS</li>\n                          <li>Include a cover letter explaining the late filing</li>\n                          <li>Be prepared for potential late filing penalties</li>\n                        </ul>\n                        <div className=\"mt-3 p-3 bg-background/50 rounded border border-orange-500/20\">\n                          <p className=\"font-semibold text-orange-600 mb-1\">üì¶ Paper Filing Package - $29</p>\n                          <p className=\"text-xs\">\n                            We'll generate pre-filled 1099-NEC forms, cover letter template, IRS mailing labels, and\n                            filing instructions.\n                          </p>\n                        </div>\n                      </AlertDescription>\n                    </Alert>\n                  ) : (\n                    <Alert className=\"bg-green-500/10 border-green-500/20\">\n                      <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                      <AlertTitle className=\"text-green-600 font-semibold\">E-Filing Available</AlertTitle>\n                      <AlertDescription className=\"text-sm\">\n                        Tax year {taxYear} is eligible for electronic filing. Complete the form below and we'll submit\n                        it directly to the IRS.\n                        <span className=\"block mt-2 text-purple-600 font-medium\">\n                          üí° Tip: Use the \"Upload 1099-NEC\" button to auto-fill with AI!\n                        </span>\n                      </AlertDescription>\n                    </Alert>\n                  )}\n                </div>\n              </CardDescription>\n            </CardHeader>\n          </Card>\n\n          {validationResults && (\n            <div className=\"space-y-3\">\n              {validationResults.errors?.map((error: any, index: number) => (\n                <Alert key={`error-${index}`} className=\"bg-red-500/10 border-red-500/20\">\n                  <AlertCircle className=\"h-4 w-4 text-red-600\" />\n                  <AlertTitle className=\"text-red-600 font-semibold\">Error: {error.field || \"Validation\"}</AlertTitle>\n                  <AlertDescription className=\"text-sm\">\n                    {typeof error === \"string\" ? error : error.message}\n                  </AlertDescription>\n                </Alert>\n              ))}\n\n              {validationResults.warnings?.map((warning: any, index: number) => (\n                <Alert\n                  key={`warning-${index}`}\n                  className={\n                    warning.field === \"system\"\n                      ? \"bg-blue-500/10 border-blue-500/20\"\n                      : \"bg-orange-500/10 border-orange-500/20\"\n                  }\n                >\n                  <AlertCircle\n                    className={`h-4 w-4 ${warning.field === \"system\" ? \"text-blue-600\" : \"text-orange-600\"}`}\n                  />\n                  <AlertTitle\n                    className={`${warning.field === \"system\" ? \"text-blue-600\" : \"text-orange-600\"} font-semibold`}\n                  >\n                    {warning.field === \"system\" ? \"Information\" : \"Warning\"}\n                  </AlertTitle>\n                  <AlertDescription className=\"text-sm\">\n                    {typeof warning === \"string\" ? warning : warning.message}\n                  </AlertDescription>\n                </Alert>\n              ))}\n\n              {validationResults.suggestions?.map((suggestion: any, index: number) => (\n                <Alert key={`suggestion-${index}`} className=\"bg-blue-500/10 border-blue-500/20\">\n                  <Sparkles className=\"h-4 w-4 text-blue-600\" />\n                  <AlertTitle className=\"text-blue-600 font-semibold\">Suggestion</AlertTitle>\n                  <AlertDescription className=\"text-sm\">\n                    {typeof suggestion === \"string\" ? suggestion : suggestion.message}\n                  </AlertDescription>\n                </Alert>\n              ))}\n\n              {validationResults.valid && !validationResults.errors?.length && (\n                <Alert className=\"bg-green-500/10 border-green-500/20\">\n                  <CheckCircle2 className=\"h-4 w-4 text-green-600\" />\n                  <AlertTitle className=\"text-green-600 font-semibold\">All Clear!</AlertTitle>\n                  <AlertDescription className=\"text-sm\">\n                    Your form passed all validation checks. Ready to submit!\n                  </AlertDescription>\n                </Alert>\n              )}\n            </div>\n          )}\n\n          {contractors.map((contractor, index) => (\n            <Card key={contractor.id} className=\"relative overflow-hidden border-white/10 bg-white/5 backdrop-blur-xl\">\n              <div className=\"absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-purple-600 to-orange-600\" />\n\n              <CardHeader>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-purple-600 to-pink-500 text-white font-semibold shadow-lg\">\n                      {index + 1}\n                    </div>\n                    <div>\n                      <CardTitle className=\"text-lg\">Contractor {index + 1}</CardTitle>\n                      <CardDescription>Enter contractor information</CardDescription>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <div className=\"relative\">\n                      <input\n                        type=\"file\"\n                        accept=\".pdf,.jpg,.jpeg,.png\"\n                        onChange={(e) => {\n                          const file = e.target.files?.[0]\n                          if (file) {\n                            handleContractorFileUpload(contractor.id, file)\n                          }\n                          e.target.value = \"\" // Reset input\n                        }}\n                        className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10\"\n                        disabled={uploadingContractorId !== null}\n                      />\n                      <Button\n                        type=\"button\"\n                        size=\"sm\"\n                        disabled={uploadingContractorId !== null}\n                        className=\"relative overflow-hidden bg-gradient-to-r from-purple-600 via-purple-500 to-pink-500 hover:from-purple-700 hover:via-purple-600 hover:to-pink-600 text-white font-semibold shadow-lg hover:shadow-xl hover:shadow-purple-500/50 transition-all duration-300 border-0 group\"\n                      >\n                        {/* Shimmer effect overlay */}\n                        <div className=\"absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-200%] group-hover:translate-x-[200%] transition-transform duration-1000\" />\n\n                        {uploadingContractorId === contractor.id ? (\n                          <>\n                            <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                            Extracting...\n                          </>\n                        ) : (\n                          <>\n                            <Sparkles className=\"h-4 w-4 mr-2 animate-pulse\" />\n                            Upload 1099-NEC (AI Extract)\n                          </>\n                        )}\n                      </Button>\n                    </div>\n\n                    {contractors.length > 1 && (\n                      <Button\n                        type=\"button\"\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        onClick={() => removeContractor(contractor.id)}\n                        className=\"hover:bg-red-500/10 hover:text-red-500\"\n                      >\n                        <Trash2 className=\"h-4 w-4\" />\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid gap-4 md:grid-cols-3\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor={`firstName-${contractor.id}`}>First Name *</Label>\n                    <Input\n                      id={`firstName-${contractor.id}`}\n                      value={contractor.firstName}\n                      onChange={(e) => updateContractor(contractor.id, \"firstName\", e.target.value)}\n                      className={validationErrors[`${contractor.id}-firstName`] ? \"border-red-500\" : \"\"}\n                      placeholder=\"John\"\n                    />\n                    {validationErrors[`${contractor.id}-firstName`] && (\n                      <p className=\"text-sm text-red-500 flex items-center gap-1\">\n                        <AlertCircle className=\"h-3 w-3\" />\n                        {validationErrors[`${contractor.id}-firstName`]}\n                      </p>\n                    )}\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor={`middleInitial-${contractor.id}`}>Middle Initial</Label>\n                    <Input\n                      id={`middleInitial-${contractor.id}`}\n                      value={contractor.middleInitial}\n                      onChange={(e) => updateContractor(contractor.id, \"middleInitial\", e.target.value.toUpperCase())}\n                      maxLength={1}\n                      placeholder=\"M\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor={`lastName-${contractor.id}`}>Last Name *</Label>\n                    <Input\n                      id={`lastName-${contractor.id}`}\n                      value={contractor.lastName}\n                      onChange={(e) => updateContractor(contractor.id, \"lastName\", e.target.value)}\n                      className={validationErrors[`${contractor.id}-lastName`] ? \"border-red-500\" : \"\"}\n                      placeholder=\"Doe\"\n                    />\n                    {validationErrors[`${contractor.id}-lastName`] && (\n                      <p className=\"text-sm text-red-500 flex items-center gap-1\">\n                        <AlertCircle className=\"h-3 w-3\" />\n                        {validationErrors[`${contractor.id}-lastName`]}\n                      </p>\n                    )}\n                  </div>\n                </div>\n\n                <div className=\"grid gap-4 md:grid-cols-2\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor={`ssn-${contractor.id}`} className=\"flex items-center gap-2\">\n                      SSN *\n                      <Lock className=\"h-3 w-3 text-green-500\" />\n                    </Label>\n                    <Input\n                      id={`ssn-${contractor.id}`}\n                      value={contractor.ssn}\n                      onChange={(e) => updateContractor(contractor.id, \"ssn\", e.target.value)}\n                      className={validationErrors[`${contractor.id}-ssn`] ? \"border-red-500\" : \"\"}\n                      placeholder=\"XXX-XX-XXXX\"\n                      maxLength={11}\n                    />\n                    {validationErrors[`${contractor.id}-ssn`] && (\n                      <p className=\"text-sm text-red-500 flex items-center gap-1\">\n                        <AlertCircle className=\"h-3 w-3\" />\n                        {validationErrors[`${contractor.id}-ssn`]}\n                      </p>\n                    )}\n                    <p className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                      <Lock className=\"h-3 w-3\" />\n                      AES-256 encrypted at rest\n                    </p>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor={`ein-${contractor.id}`} className=\"flex items-center gap-2\">\n                      EIN (if business)\n                      <Lock className=\"h-3 w-3 text-green-500\" />\n                    </Label>\n                    <Input\n                      id={`ein-${contractor.id}`}\n                      value={contractor.ein}\n                      onChange={(e) => updateContractor(contractor.id, \"ein\", e.target.value)}\n                      className={validationErrors[`${contractor.id}-ein`] ? \"border-red-500\" : \"\"}\n                      placeholder=\"XX-XXXXXXX\"\n                      maxLength={10}\n                    />\n                    {validationErrors[`${contractor.id}-ein`] && (\n                      <p className=\"text-sm text-red-500 flex items-center gap-1\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {validationErrors[`${contractor.id}-ein`]}\n                      </p>\n                    )}\n                    <p className=\"text-xs text-muted-foreground flex items-center gap-1\">\n                      <Lock className=\"h-3 w-3\" />\n                      Encrypted and secure\n                    </p>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor={`email-${contractor.id}`}>Email</Label>\n                  <Input\n                    id={`email-${contractor.id}`}\n                    type=\"email\"\n                    value={contractor.email}\n                    onChange={(e) => updateContractor(contractor.id, \"email\", e.target.value)}\n                    placeholder=\"contractor@example.com\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor={`address-${contractor.id}`}>Street Address *</Label>\n                  <Input\n                    id={`address-${contractor.id}`}\n                    value={contractor.address}\n                    onChange={(e) => updateContractor(contractor.id, \"address\", e.target.value)}\n                    className={validationErrors[`${contractor.id}-address`] ? \"border-red-500\" : \"\"}\n                    placeholder=\"123 Main Street\"\n                  />\n                  {validationErrors[`${contractor.id}-address`] && (\n                    <p className=\"text-sm text-red-500 flex items-center gap-1\">\n                      <AlertCircle className=\"h-4 w-4\" />\n                      {validationErrors[`${contractor.id}-address`]}\n                    </p>\n                  )}\n                </div>\n\n                <div className=\"grid gap-4 md:grid-cols-3\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor={`city-${contractor.id}`}>City *</Label>\n                    <Input\n                      id={`city-${contractor.id}`}\n                      value={contractor.city}\n                      onChange={(e) => updateContractor(contractor.id, \"city\", e.target.value)}\n                      className={validationErrors[`${contractor.id}-city`] ? \"border-red-500\" : \"\"}\n                      placeholder=\"San Francisco\"\n                    />\n                    {validationErrors[`${contractor.id}-city`] && (\n                      <p className=\"text-sm text-red-500 flex items-center gap-1\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {validationErrors[`${contractor.id}-city`]}\n                      </p>\n                    )}\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor={`state-${contractor.id}`}>State *</Label>\n                    <Select\n                      value={contractor.state}\n                      onValueChange={(value) => updateContractor(contractor.id, \"state\", value)}\n                    >\n                      <SelectTrigger className={validationErrors[`${contractor.id}-state`] ? \"border-red-500\" : \"\"}>\n                        <SelectValue placeholder=\"Select state\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {US_STATES.map((state) => (\n                          <SelectItem key={state} value={state}>\n                            {state}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                    {validationErrors[`${contractor.id}-state`] && (\n                      <p className=\"text-sm text-red-500 flex items-center gap-1\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {validationErrors[`${contractor.id}-state`]}\n                      </p>\n                    )}\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor={`zipCode-${contractor.id}`}>ZIP Code *</Label>\n                    <Input\n                      id={`zipCode-${contractor.id}`}\n                      value={contractor.zipCode}\n                      onChange={(e) => updateContractor(contractor.id, \"zipCode\", e.target.value)}\n                      className={validationErrors[`${contractor.id}-zipCode`] ? \"border-red-500\" : \"\"}\n                      placeholder=\"94102\"\n                      maxLength={10}\n                    />\n                    {validationErrors[`${contractor.id}-zipCode`] && (\n                      <p className=\"text-sm text-red-500 flex items-center gap-1\">\n                        <AlertCircle className=\"h-4 w-4\" />\n                        {validationErrors[`${contractor.id}-zipCode`]}\n                      </p>\n                    )}\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor={`compensation-${contractor.id}`}>Nonemployee Compensation (Box 1) *</Label>\n                  <div className=\"relative\">\n                    <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground\">$</span>\n                    <Input\n                      id={`compensation-${contractor.id}`}\n                      type=\"number\"\n                      step=\"0.01\"\n                      value={contractor.compensation}\n                      onChange={(e) => updateContractor(contractor.id, \"compensation\", e.target.value)}\n                      className={`pl-7 ${validationErrors[`${contractor.id}-compensation`] ? \"border-red-500\" : \"\"}`}\n                      placeholder=\"0.00\"\n                    />\n                  </div>\n                  {validationErrors[`${contractor.id}-compensation`] && (\n                    <p className=\"text-sm text-red-500 flex items-center gap-1\">\n                      <AlertCircle className=\"h-4 w-4\" />\n                      {validationErrors[`${contractor.id}-compensation`]}\n                    </p>\n                  )}\n                  <p className=\"text-xs text-muted-foreground\">Minimum $600 required for 1099-NEC filing</p>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center space-x-2\">\n                    <input\n                      type=\"checkbox\"\n                      id={`directSales-${contractor.id}`}\n                      checked={contractor.directSales5000Plus}\n                      onChange={(e) =>\n                        updateContractor(contractor.id, \"directSales5000Plus\", e.target.checked.toString())\n                      }\n                      className=\"h-4 w-4 rounded border-gray-300\"\n                    />\n                    <Label htmlFor={`directSales-${contractor.id}`} className=\"text-sm font-normal\">\n                      Payer made direct sales totaling $5,000 or more of consumer products to recipient for resale (Box\n                      2)\n                    </Label>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor={`federalTaxWithheld-${contractor.id}`}>Federal Income Tax Withheld (Box 4)</Label>\n                  <div className=\"relative\">\n                    <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground\">$</span>\n                    <Input\n                      id={`federalTaxWithheld-${contractor.id}`}\n                      type=\"number\"\n                      step=\"0.01\"\n                      value={contractor.federalTaxWithheld}\n                      onChange={(e) => updateContractor(contractor.id, \"federalTaxWithheld\", e.target.value)}\n                      className=\"pl-7\"\n                      placeholder=\"0.00\"\n                    />\n                  </div>\n                  <p className=\"text-xs text-muted-foreground\">Backup withholding or voluntary federal tax withheld</p>\n                </div>\n\n                <div className=\"grid gap-4 md:grid-cols-3\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor={`stateTaxWithheld-${contractor.id}`}>State Tax Withheld (Box 5)</Label>\n                    <div className=\"relative\">\n                      <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground\">$</span>\n                      <Input\n                        id={`stateTaxWithheld-${contractor.id}`}\n                        type=\"number\"\n                        step=\"0.01\"\n                        value={contractor.stateTaxWithheld}\n                        onChange={(e) => updateContractor(contractor.id, \"stateTaxWithheld\", e.target.value)}\n                        className=\"pl-7\"\n                        placeholder=\"0.00\"\n                      />\n                    </div>\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor={`statePayerNumber-${contractor.id}`}>State/Payer's State No. (Box 6)</Label>\n                    <Input\n                      id={`statePayerNumber-${contractor.id}`}\n                      value={contractor.statePayerNumber}\n                      onChange={(e) => updateContractor(contractor.id, \"statePayerNumber\", e.target.value)}\n                      placeholder=\"State ID number\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor={`stateIncome-${contractor.id}`}>State Income (Box 7)</Label>\n                    <div className=\"relative\">\n                      <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground\">$</span>\n                      <Input\n                        id={`stateIncome-${contractor.id}`}\n                        type=\"number\"\n                        step=\"0.01\"\n                        value={contractor.stateIncome}\n                        onChange={(e) => updateContractor(contractor.id, \"stateIncome\", e.target.value)}\n                        className=\"pl-7\"\n                        placeholder=\"0.00\"\n                      />\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor={`accountNumber-${contractor.id}`}>Account Number (optional)</Label>\n                  <Input\n                    id={`accountNumber-${contractor.id}`}\n                    value={contractor.accountNumber}\n                    onChange={(e) => updateContractor(contractor.id, \"accountNumber\", e.target.value)}\n                    placeholder=\"For internal tracking\"\n                  />\n                  <p className=\"text-xs text-muted-foreground\">Use if you file multiple 1099s for this contractor</p>\n                </div>\n\n                <div className=\"space-y-3 pt-4 border-t border-border\">\n                  <p className=\"text-sm font-medium\">Additional Options</p>\n                  <div className=\"grid gap-3 md:grid-cols-2\">\n                    <div className=\"flex items-center space-x-2\">\n                      <input\n                        type=\"checkbox\"\n                        id={`void-${contractor.id}`}\n                        checked={contractor.isVoid}\n                        onChange={(e) => updateContractor(contractor.id, \"isVoid\", e.target.checked.toString())}\n                        className=\"h-4 w-4 rounded border-gray-300\"\n                      />\n                      <Label htmlFor={`void-${contractor.id}`} className=\"text-sm font-normal\">\n                        VOID (mark if this form should be voided)\n                      </Label>\n                    </div>\n                    <div className=\"flex items-center space-x-2\">\n                      <input\n                        type=\"checkbox\"\n                        id={`corrected-${contractor.id}`}\n                        checked={contractor.isCorrected}\n                        onChange={(e) => updateContractor(contractor.id, \"isCorrected\", e.target.checked.toString())}\n                        className=\"h-4 w-4 rounded border-gray-300\"\n                      />\n                      <Label htmlFor={`corrected-${contractor.id}`} className=\"text-sm font-normal\">\n                        CORRECTED (mark if correcting a previously filed form)\n                      </Label>\n                    </div>\n                    <div className=\"flex items-center space-x-2\">\n                      <input\n                        type=\"checkbox\"\n                        id={`secondTin-${contractor.id}`}\n                        checked={contractor.secondTinNotification}\n                        onChange={(e) =>\n                          updateContractor(contractor.id, \"secondTinNotification\", e.target.checked.toString())\n                        }\n                        className=\"h-4 w-4 rounded border-gray-300\"\n                      />\n                      <Label htmlFor={`secondTin-${contractor.id}`} className=\"text-sm font-normal\">\n                        2nd TIN not. (IRS notified twice about incorrect TIN)\n                      </Label>\n                    </div>\n                    <div className=\"flex items-center space-x-2\">\n                      <input\n                        type=\"checkbox\"\n                        id={`fatca-${contractor.id}`}\n                        checked={contractor.isFatcaFiling}\n                        onChange={(e) => updateContractor(contractor.id, \"isFatcaFiling\", e.target.checked.toString())}\n                        className=\"h-4 w-4 rounded border-gray-300\"\n                      />\n                      <Label htmlFor={`fatca-${contractor.id}`} className=\"text-sm font-normal\">\n                        FATCA filing requirement\n                      </Label>\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            onClick={addContractor}\n            className=\"w-full border-purple-500/20 hover:border-purple-500/50 bg-purple-500/5 hover:bg-purple-500/10\"\n          >\n            <Sparkles className=\"mr-2 h-4 w-4\" />\n            Add Another Contractor\n          </Button>\n\n          <div className=\"flex flex-col gap-4 pt-6 border-t border-border\">\n            <div className=\"flex gap-4\">\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                onClick={handleAIValidation}\n                disabled={isValidating || isSubmitting}\n                className=\"flex-1 bg-transparent border-blue-500/20\"\n              >\n                {isValidating ? (\n                  <>\n                    <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                    Validating...\n                  </>\n                ) : (\n                  <>\n                    <Sparkles className=\"mr-2 h-4 w-4\" />\n                    AI Validate Form\n                  </>\n                )}\n              </Button>\n\n              {isPaperFilingRequired && (\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setShowPenaltyDialog(true)}\n                  className=\"flex-1 bg-transparent border-orange-500/20\"\n                >\n                  <FileText className=\"mr-2 h-4 w-4\" />\n                  Generate Penalty Letter ($19)\n                </Button>\n              )}\n            </div>\n\n            <Button\n              type=\"submit\"\n              disabled={isSubmitting || isValidating}\n              className=\"w-full bg-gradient-to-r from-purple-600 to-orange-600 hover:from-purple-700 hover:to-orange-700 shadow-lg text-lg py-6\"\n            >\n              Continue to Review\n              <ArrowRight className=\"ml-2 h-5 w-5\" />\n            </Button>\n          </div>\n        </>\n      )}\n\n      <FilingProgressDialog\n        open={showProgressDialog}\n        currentStep={filingProgress}\n        steps={progressSteps}\n        isComplete={filingProgress === 4}\n        isError={false}\n        onClose={() => {\n          setShowProgressDialog(false)\n          setFilingProgress(0)\n          if (filingProgress === 4) {\n            router.push(\"/dashboard/filing\")\n          }\n        }}\n      />\n\n      <PenaltyAbatementDialog\n        open={showPenaltyDialog}\n        onOpenChange={setShowPenaltyDialog}\n        formType=\"1099-NEC\"\n        taxYear={taxYear}\n        businessName=\"\"\n        ein=\"\"\n      />\n    </form>\n  )\n}\n","/**\n * Parses combined city/state/ZIP strings into separate components\n * Examples:\n * - \"CAMDEN NJ 08103\" -> { city: \"CAMDEN\", state: \"NJ\", zipCode: \"08103\" }\n * - \"NEW YORK NY 10001\" -> { city: \"NEW YORK\", state: \"NY\", zipCode: \"10001\" }\n * - \"SAN FRANCISCO CA 94102\" -> { city: \"SAN FRANCISCO\", state: \"CA\", zipCode: \"94102\" }\n */\nexport function parseAddress(addressString: string): {\n  city: string\n  state: string\n  zipCode: string\n} | null {\n  if (!addressString) return null\n\n  // Trim and normalize whitespace\n  const normalized = addressString.trim().replace(/\\s+/g, \" \")\n\n  // Pattern: City (one or more words) + State (2 letters) + ZIP (5 or 9 digits)\n  // Examples: \"CAMDEN NJ 08103\", \"NEW YORK NY 10001\", \"SAN FRANCISCO CA 94102\"\n  const pattern = /^(.+?)\\s+([A-Z]{2})\\s+(\\d{5}(?:-\\d{4})?)$/i\n\n  const match = normalized.match(pattern)\n\n  if (match) {\n    return {\n      city: match[1].trim(),\n      state: match[2].toUpperCase(),\n      zipCode: match[3],\n    }\n  }\n\n  // If no match, return null (let the original value stay)\n  return null\n}\n\n/**\n * Parses a full address line that may contain street, city, state, and ZIP\n * Example: \"123 Main St, CAMDEN NJ 08103\"\n */\nexport function parseFullAddress(addressLine: string): {\n  street?: string\n  city: string\n  state: string\n  zipCode: string\n} | null {\n  if (!addressLine) return null\n\n  // Check if there's a comma separating street from city/state/ZIP\n  const parts = addressLine.split(\",\").map((p) => p.trim())\n\n  if (parts.length === 2) {\n    // Format: \"123 Main St, CAMDEN NJ 08103\"\n    const parsed = parseAddress(parts[1])\n    if (parsed) {\n      return {\n        street: parts[0],\n        ...parsed,\n      }\n    }\n  }\n\n  // Try parsing the whole thing as city/state/ZIP\n  return parseAddress(addressLine)\n}\n"],"names":[],"mappings":"mDAEA,EAAA,CAAA,CAAA,QCCA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QAAA,EAAA,CAAA,CAAA,QAAA,EAAA,CAAA,CAAA,OAAA,EAAA,CAAA,CAAA,QAAA,EAAA,CAAA,CAAA,QAAA,EAAA,CAAA,CAAA,QAAA,EAAA,CAAA,CAAA,QAAA,EAAA,CAAA,CAAA,OAAA,EAAA,CAAA,CAAA,QAAA,EAAA,CAAA,CAAA,QAYA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QAEA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QACA,EAAA,CAAA,CAAA,QDxBA,EAAA,CAAA,CAAA"}