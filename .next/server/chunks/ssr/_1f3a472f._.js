module.exports=[231807,a=>{"use strict";let b=(0,a.i(550349).default)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);a.s(["ArrowLeft",0,b],231807)},666929,a=>{"use strict";let b=(0,a.i(550349).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);a.s(["Trash2",0,b],666929)},653524,a=>{"use strict";var b=a.i(117462);a.i(421252);var c=a.i(665500),d=a.i(108446),e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,e)=>{let f=(0,c.createSlot)(`Primitive.${e}`),g=b.forwardRef((a,b)=>{let{asChild:c,...g}=a;return(0,d.jsx)(c?f:e,{...g,ref:b})});return g.displayName=`Primitive.${e}`,{...a,[e]:g}},{});a.s(["Primitive",0,e])},917171,a=>{"use strict";var b=a.i(108446),c=a.i(117462),d=a.i(653524),e=c.forwardRef((a,c)=>(0,b.jsx)(d.Primitive.label,{...a,ref:c,onMouseDown:b=>{b.target.closest("button, input, select, textarea")||(a.onMouseDown?.(b),!b.defaultPrevented&&b.detail>1&&b.preventDefault())}}));e.displayName="Label";var f=a.i(497895);a.s(["Label",0,function({className:a,...c}){return(0,b.jsx)(e,{"data-slot":"label",className:(0,f.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",a),...c})}],917171)},251555,a=>{"use strict";var b=a.i(117462);a.s(["usePrevious",0,function(a){let c=b.useRef({value:a,previous:a});return b.useMemo(()=>(c.current.value!==a&&(c.current.previous=c.current.value,c.current.value=a),c.current.previous),[a])}])},711867,a=>{"use strict";let b=(0,a.i(550349).default)("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);a.s(["default",0,b])},48972,a=>{"use strict";a.s(["clamp",0,function(a,[b,c]){return Math.min(c,Math.max(b,a))}])},546893,a=>{"use strict";var b=a.i(108446),c=a.i(497895);a.s(["Textarea",0,function({className:a,...d}){return(0,b.jsx)("textarea",{"data-slot":"textarea",className:(0,c.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",a),...d})}])},899482,a=>{"use strict";var b=a.i(269240);a.s(["getSupabaseBooksClient",0,function(){return(0,b.createClient)()}])},929563,a=>{"use strict";var b=a.i(108446),c=a.i(117462),d=a.i(303314),e=a.i(340695),f=a.i(703130),g=a.i(205522),h=a.i(917171),i=a.i(546893),j=a.i(887682),k=a.i(100715),l=a.i(666929),m=a.i(231807),n=a.i(830336),o=a.i(899482),p=a.i(269240);a.s(["InvoiceFormClient",0,function(){let a=(0,d.useRouter)(),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)([]),[w,x]=(0,c.useState)({customer_id:"",invoice_number:`INV-${Date.now()}`,invoice_date:new Date().toISOString().split("T")[0],due_date:new Date(Date.now()+2592e6).toISOString().split("T")[0],notes:"",terms:"Net 30"}),[y,z]=(0,c.useState)([{description:"",quantity:1,unit_price:0,amount:0}]);async function A(){console.log("[v0] Loading customers..."),t(!0);try{let a=(0,o.getSupabaseBooksClient)(),b=(0,p.createClient)(),c=[];if(a){let{data:b,error:d}=await a.from("contacts").select("*").eq("kind","customer").order("display_name");!d&&b?(console.log("[v0] Loaded",b.length,"customers from books.contacts"),c=[...c,...b.map(a=>({...a,source:"books"}))]):d&&console.error("[v0] Error loading from books.contacts:",d)}let{data:d,error:e}=await b.from("customers").select("*").eq("is_active",!0).order("company_name");if(!e&&d?(console.log("[v0] Loaded",d.length,"customers from public.customers"),c=[...c,...d.map(a=>({id:a.id,display_name:a.company_name||a.contact_name||"Unnamed Customer",email:a.email,source:"public"}))]):e&&console.error("[v0] Error loading from public.customers:",e),0===c.length){let{data:a,error:d}=await b.from("contacts").select("*").eq("contact_type","customer").order("name");!d&&a&&(console.log("[v0] Loaded",a.length,"customers from public.contacts"),c=a.map(a=>({id:a.id,display_name:a.display_name||a.name||a.company_name||"Unnamed Customer",email:a.email,source:"contacts"})))}console.log("[v0] Total customers loaded:",c.length),v(c)}catch(a){console.error("[v0] Error loading customers:",a)}finally{t(!1)}}function B(a,b,c){let d=[...y];d[a]={...d[a],[b]:c},("quantity"===b||"unit_price"===b)&&(d[a].amount=d[a].quantity*d[a].unit_price),z(d)}(0,c.useEffect)(()=>{A()},[]);let C=y.reduce((a,b)=>a+b.amount,0),D=.1*C,E=C+D;async function F(b){b.preventDefault(),r(!0);try{console.log("[v0] Creating invoice with data:",{...w,items:y});let b=await fetch("/api/accounting/invoices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customer_id:w.customer_id,invoice_number:w.invoice_number,invoice_date:w.invoice_date,due_date:w.due_date,notes:w.notes,terms:w.terms,items:y})}),c=await b.json();if(!b.ok)throw console.error("[v0] Invoice creation failed:",c),Error(c.error||"Failed to create invoice");console.log("[v0] Invoice created successfully:",c),a.push("/accounting/invoices")}catch(a){console.error("[v0] Error creating invoice:",a),alert(a instanceof Error?a.message:"Failed to create invoice")}finally{r(!1)}}return(0,b.jsx)("form",{onSubmit:F,children:(0,b.jsxs)(f.Card,{className:"p-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-6 mb-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"customer",children:"Customer *"}),(0,b.jsxs)(j.Select,{value:w.customer_id,onValueChange:a=>{console.log("[v0] Selected customer:",a),x({...w,customer_id:a})},disabled:s,children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{placeholder:s?"Loading customers...":0===u.length?"No customers found":"Select customer"})}),(0,b.jsxs)(j.SelectContent,{children:[0===u.length&&!s&&(0,b.jsxs)("div",{className:"p-4 text-center text-sm text-muted-foreground",children:["No customers available."," ",(0,b.jsx)(n.default,{href:"/accounting/customers",className:"text-primary underline",children:"Add a customer"})," ","first."]}),u.map(a=>(0,b.jsxs)(j.SelectItem,{value:a.id,children:[a.display_name," ",a.email&&`(${a.email})`]},a.id))]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"invoice_number",children:"Invoice Number *"}),(0,b.jsx)(g.Input,{id:"invoice_number",value:w.invoice_number,onChange:a=>x({...w,invoice_number:a.target.value}),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"invoice_date",children:"Invoice Date *"}),(0,b.jsx)(g.Input,{id:"invoice_date",type:"date",value:w.invoice_date,onChange:a=>x({...w,invoice_date:a.target.value}),required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"due_date",children:"Due Date *"}),(0,b.jsx)(g.Input,{id:"due_date",type:"date",value:w.due_date,onChange:a=>x({...w,due_date:a.target.value}),required:!0})]})]}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsx)(h.Label,{children:"Line Items"}),(0,b.jsxs)(e.Button,{type:"button",variant:"outline",size:"sm",onClick:function(){z([...y,{description:"",quantity:1,unit_price:0,amount:0}])},children:[(0,b.jsx)(k.Plus,{className:"h-4 w-4 mr-2"}),"Add Line"]})]}),(0,b.jsx)("div",{className:"space-y-4",children:y.map((a,c)=>(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-4 items-end",children:[(0,b.jsxs)("div",{className:"col-span-5",children:[(0,b.jsx)(h.Label,{children:"Description"}),(0,b.jsx)(g.Input,{value:a.description,onChange:a=>B(c,"description",a.target.value),placeholder:"Item description",required:!0})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(h.Label,{children:"Quantity"}),(0,b.jsx)(g.Input,{type:"number",value:a.quantity,onChange:a=>B(c,"quantity",Number.parseFloat(a.target.value)||0),min:"0",step:"0.01",required:!0})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(h.Label,{children:"Unit Price"}),(0,b.jsx)(g.Input,{type:"number",value:a.unit_price,onChange:a=>B(c,"unit_price",Number.parseFloat(a.target.value)||0),min:"0",step:"0.01",required:!0})]}),(0,b.jsxs)("div",{className:"col-span-2",children:[(0,b.jsx)(h.Label,{children:"Amount"}),(0,b.jsx)(g.Input,{value:`$${a.amount.toFixed(2)}`,disabled:!0})]}),(0,b.jsx)("div",{className:"col-span-1",children:(0,b.jsx)(e.Button,{type:"button",variant:"ghost",size:"icon",onClick:()=>{z(y.filter((a,b)=>b!==c))},disabled:1===y.length,children:(0,b.jsx)(l.Trash2,{className:"h-4 w-4"})})})]},c))})]}),(0,b.jsx)("div",{className:"border-t pt-6 mb-6",children:(0,b.jsx)("div",{className:"flex justify-end",children:(0,b.jsxs)("div",{className:"w-64 space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Subtotal:"}),(0,b.jsxs)("span",{className:"font-medium",children:["$",C.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"Tax (10%):"}),(0,b.jsxs)("span",{className:"font-medium",children:["$",D.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between text-lg font-bold border-t pt-2",children:[(0,b.jsx)("span",{children:"Total:"}),(0,b.jsxs)("span",{children:["$",E.toFixed(2)]})]})]})})}),(0,b.jsx)("div",{className:"grid grid-cols-2 gap-6 mb-6",children:(0,b.jsxs)("div",{children:[(0,b.jsx)(h.Label,{htmlFor:"terms",children:"Payment Terms"}),(0,b.jsx)(g.Input,{id:"terms",value:w.terms,onChange:a=>x({...w,terms:a.target.value}),placeholder:"Net 30"})]})}),(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)(h.Label,{htmlFor:"notes",children:"Notes"}),(0,b.jsx)(i.Textarea,{id:"notes",value:w.notes,onChange:a=>x({...w,notes:a.target.value}),placeholder:"Additional notes or terms...",rows:4})]}),(0,b.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,b.jsx)(n.default,{href:"/accounting/invoices",children:(0,b.jsxs)(e.Button,{type:"button",variant:"outline",children:[(0,b.jsx)(m.ArrowLeft,{className:"h-4 w-4 mr-2"}),"Cancel"]})}),(0,b.jsx)(e.Button,{type:"submit",disabled:q||!w.customer_id||0===y.length||y.some(a=>!a.description),className:"bg-gradient-to-r from-purple-600 to-orange-500 hover:from-purple-700 hover:to-orange-600",children:q?"Creating...":"Create Invoice"})]})]})})}])}];

//# sourceMappingURL=_1f3a472f._.js.map