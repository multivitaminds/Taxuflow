module.exports=[824332,e=>{"use strict";var t=e.i(682544),a=e.i(477416),r=e.i(888760),s=e.i(178890),n=e.i(685495),i=e.i(590424),o=e.i(333238),l=e.i(531427),d=e.i(172393),c=e.i(501598),u=e.i(133377),p=e.i(15902),m=e.i(115676),g=e.i(110214),h=e.i(376296),f=e.i(193695);e.i(633637);var v=e.i(712539),y=e.i(498065),x=e.i(110043),E=e.i(254799);function N(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async function T(){console.log("[v0] Server env check:",{hasUrl:!0,hasKey:!0});let e=process.env.TAXBANDITS_CLIENT_ID,t=process.env.TAXBANDITS_API_SECRET;if(!e||!t)throw console.log("[v0] TaxBandits credentials not configured, using demo mode"),Error("TaxBandits credentials not configured. Please add TAXBANDITS_CLIENT_ID and TAXBANDITS_API_SECRET environment variables.");let a=process.env.TAXBANDITS_ENVIRONMENT||"sandbox",r=Math.floor(Date.now()/1e3),s=N(Buffer.from(JSON.stringify({alg:"HS256",typ:"JWT"})).toString("base64")),n=N(Buffer.from(JSON.stringify({iss:e,sub:e,aud:"TaxBanditsAPI",iat:r,exp:r+300})).toString("base64")),i=N((0,E.createHmac)("sha256",t).update(`${s}.${n}`).digest("base64")),o=`${s}.${n}.${i}`;console.log("[v0] Requesting TaxBandits access token...");let l=await fetch("production"===a?"https://oauth.expressauth.net/v2/tbsauth":"https://testoauth.expressauth.net/v2/tbsauth",{method:"GET",headers:{Authentication:o}});if(!l.ok){let e=await l.json();throw console.error("[v0] TaxBandits authentication failed:",e),Error(`Failed to authenticate with TaxBandits: ${e.StatusMessage||"Unknown error"}`)}let d=await l.json();return console.log("[v0] TaxBandits authentication successful"),d.AccessToken}async function S(e){try{let t,a;console.log("[v0] POST /api/filing/submit-extracted - Request received");try{t=await e.json()}catch(e){return console.error("[v0] Failed to parse request body:",e),y.NextResponse.json({success:!1,error:"Invalid request body"},{status:400})}let{userId:r,documents:s}=t;if(!s||!Array.isArray(s)||0===s.length)return console.error("[v0] Invalid documents array"),y.NextResponse.json({success:!1,error:"No documents provided"},{status:400});console.log("[v0] Submitting extracted documents, count:",s?.length),console.log("[v0] Document types:",s?.map(e=>e.documentType));let n=await (0,x.createClient)(),{data:{user:i},error:o}=await n.auth.getUser();if(o||!i)return console.error("[v0] Authentication failed:",o),y.NextResponse.json({success:!1,error:"Unauthorized"},{status:401});console.log("[v0] User authenticated:",i.id);try{a=await T()}catch(e){return console.error("[v0] Failed to get TaxBandits access token:",e),y.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to authenticate with TaxBandits"},{status:500})}let l=[];for(let e of s)try{let{documentType:t,taxYear:r,employer:s,employee:o,payer:d,recipient:c,income:u,isTemplateData:p}=e;if(console.log("[v0] Processing document type:",t),console.log("[v0] Full document data:",JSON.stringify(e,null,2)),!0===p)throw Error("This document contains template or demonstration data and cannot be filed. Please upload a real tax document with actual taxpayer information.");if("w2"===t){let e={SubmissionManifest:{TaxYear:r||new Date().getFullYear()-1,IsFederalFiling:!0,IsStateFiling:!0},ReturnHeader:{Business:{BusinessNm:s?.name,EIN:s?.ein?.replace(/-/g,""),BusinessType:"Corporation"}},FormW2:[{SequenceNum:1,Employee:{SSN:o?.ssn?.replace(/-/g,""),FirstNm:o?.name?.split(" ")[0],LastNm:o?.name?.split(" ").slice(1).join(" "),Address:{AddressLine1:o?.address?.split(",")[0],City:o?.address?.split(",")[1]?.trim(),State:u?.state||"CA",ZipCode:o?.address?.match(/\d{5}/)?.[0]||"00000"}},Wages:u?.wages||0,FederalIncomeTaxWithheld:u?.federalWithholding||0,SocialSecurityWages:u?.socialSecurityWages||0,SocialSecurityTaxWithheld:u?.socialSecurityTax||0,MedicareWages:u?.medicareWages||0,MedicareTaxWithheld:u?.medicareTax||0,StateWages:u?.stateWages||0,StateIncomeTax:u?.stateTax||0}]},t=await fetch("https://testapi.taxbandits.com/v1.7.3/Form/W2",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw console.error("[v0] TaxBandits W-2 submission failed:",e),Error(`TaxBandits W-2 submission failed: ${e.StatusMessage||e.Errors?.[0]?.Message||"Unknown error"}`)}let d=await t.json();console.log("[v0] W-2 submitted successfully:",d.SubmissionId);let{data:c}=await n.from("tax_filings").insert({user_id:i.id,form_type:"W-2",tax_year:r||new Date().getFullYear()-1,filing_status:"single",provider_name:"taxbandits",submission_id:d.SubmissionId,irs_status:"pending",filed_at:new Date().toISOString()}).select().single();l.push(c)}else if("1099-nec"===t){console.log("[v0] Processing 1099-NEC form..."),console.log("[v0] Payer data:",JSON.stringify(d,null,2)),console.log("[v0] Recipient data:",JSON.stringify(c,null,2)),console.log("[v0] Income data:",JSON.stringify(u,null,2));let e=c?.firstName||c?.name?.split(" ")[0]||"",t=c?.lastName||c?.name?.split(" ").slice(1).join(" ")||"",s=c?.ssn?.replace(/[^0-9]/g,"")||c?.ein?.replace(/[^0-9]/g,"")||c?.tin?.replace(/[^0-9]/g,"")||"";if(!s||s.length<9)throw Error("Invalid or missing recipient TIN (SSN/EIN). The document may contain masked or template data. Please upload a document with real taxpayer information.");let o=c?.ssn||c?.ein||c?.tin||"";if(o.includes("X")||o.includes("*"))throw Error("The recipient TIN appears to be masked (e.g., XXX-XX-1234). Please upload a document with the complete, unmasked TIN for filing.");let p=c?.address?.split(",")||[],m=p[0]?.trim()||c?.street||"",g=c?.city||p[1]?.trim()||"",h=c?.state||"",f=c?.zipCode||c?.zip||c?.address?.match(/\d{5}/)?.[0]||"",v=d?.address?.split(",")||[];v[0]?.trim()||d?.street;let y=d?.city||v[1]?.trim()||"",x=d?.state||"",E=d?.zipCode||d?.zip||d?.address?.match(/\d{5}/)?.[0]||"";if(console.log("[v0] Parsed recipient name:",{recipientFirstName:e,recipientLastName:t}),console.log("[v0] Parsed recipient TIN:",s?"***"+s.slice(-4):"MISSING"),console.log("[v0] Parsed recipient address:",{recipientStreet:m,recipientCity:g,recipientState:h,recipientZip:f}),!d?.name||!d?.ein)throw Error("Payer name and EIN are required");if(!e||!t)throw Error("Recipient first and last name are required");let N=Number.parseFloat(u?.nonemployeeCompensation||u?.nonemployee_compensation||u?.compensation||"0"),T=Number.parseFloat(u?.federalTaxWithheld||u?.federal_tax_withheld||u?.federalWithholding||"0");console.log("[v0] Parsed amounts:",{nonemployeeCompensation:N,federalTaxWithheld:T});let S={SubmissionManifest:{TaxYear:r||new Date().getFullYear()-1,IsFederalFiling:!0,IsStateFiling:!0},ReturnHeader:{Business:{BusinessNm:d.name,EIN:d.ein.replace(/[^0-9]/g,""),BusinessType:"Corporation"}},Form1099NEC:[{SequenceNum:1,Recipient:{TIN:s,FirstNm:e,LastNm:t,Address:{AddressLine1:m,City:g,State:h,ZipCode:f}},NonemployeeCompensation:N,FederalIncomeTaxWithheld:T}]};console.log("[v0] 1099-NEC payload prepared:",JSON.stringify(S,null,2));let w=await fetch("https://testapi.taxbandits.com/v1.7.3/Form/1099NEC",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(S)});if(console.log("[v0] TaxBandits response status:",w.status),!w.ok){let e=await w.text();console.error("[v0] TaxBandits 1099-NEC submission failed:",e);let t="Unknown error";try{let a=JSON.parse(e);t=a.StatusMessage||a.Errors?.[0]?.Message||e}catch{t=e}throw Error(`TaxBandits 1099-NEC submission failed: ${t}`)}let R=await w.json();console.log("[v0] 1099-NEC submitted successfully:",R.SubmissionId);let{data:_,error:b}=await n.from("nec_1099_filings").insert({user_id:i.id,submission_id:R.SubmissionId,tax_year:r||new Date().getFullYear()-1,filing_type:"original",irs_status:"pending",taxbandits_status:"Created",payer_name:d.name,payer_ein:d.ein,payer_address:d.address,payer_city:y,payer_state:x,payer_zip:E,recipient_first_name:e,recipient_last_name:t,recipient_address:c.address,recipient_city:g,recipient_state:h,recipient_zip:f,recipient_email:c?.email,nonemployee_compensation:N,federal_tax_withheld:T,submitted_at:new Date().toISOString()}).select().single();if(b)throw console.error("[v0] Failed to save 1099-NEC filing to database:",b),console.error("[v0] Insert error details:",JSON.stringify(b,null,2)),Error(`Failed to save filing: ${b.message}`);console.log("[v0] 1099-NEC filing saved to database:",_.id),l.push(_)}}catch(e){return console.error("[v0] Error processing document:",e),console.error("[v0] Error stack:",e instanceof Error?e.stack:"No stack trace"),y.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to process document",details:e instanceof Error?e.stack:void 0},{status:500})}return console.log("[v0] Successfully submitted",l.length,"filings to TaxBandits"),y.NextResponse.json({success:!0,filings:l,message:`Successfully filed ${l.length} tax form(s)`})}catch(e){return console.error("[v0] Extracted filing submission error:",e),console.error("[v0] Error stack:",e instanceof Error?e.stack:"No stack trace"),y.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to submit filing",details:e instanceof Error?e.stack:void 0},{status:500})}}e.s(["POST",0,S],798222);var w=e.i(798222);let R=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/filing/submit-extracted/route",pathname:"/api/filing/submit-extracted",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/taxu-platform/v0-taxu-landing-page/app/api/filing/submit-extracted/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:_,workUnitAsyncStorage:b,serverHooks:C}=R;async function I(e,t,r){R.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let y="/api/filing/submit-extracted/route";y=y.replace(/\/index$/,"")||"/";let x=await R.prepare(e,t,{srcPage:y,multiZoneDraftMode:!1});if(!x)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:E,params:N,nextConfig:T,parsedUrl:S,isDraftMode:w,prerenderManifest:_,routerServerContext:b,isOnDemandRevalidate:C,revalidateOnlyGenerated:I,resolvedPathname:A,clientReferenceManifest:P,serverActionsManifest:O}=x,F=(0,o.normalizeAppPath)(y),k=!!(_.dynamicRoutes[F]||_.routes[A]),B=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,S,!1):t.end("This page could not be found"),null);if(k&&!w){let e=!!_.routes[A],t=_.dynamicRoutes[F];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await B();throw new f.NoFallbackError}}let D=null;!k||R.isDev||w||(D="/index"===(D=A)?"/":D);let j=!0===R.isDev||!k,M=k&&!j;O&&P&&(0,i.setManifestsSingleton)({page:y,clientReferenceManifest:P,serverActionsManifest:O});let U=e.method||"GET",W=(0,n.getTracer)(),q=W.getActiveScopeSpan(),H={params:N,prerenderManifest:_,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:j,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,s)=>R.onRequestError(e,t,r,s,b)},sharedContext:{buildId:E}},$=new l.NodeNextRequest(e),X=new l.NodeNextResponse(t),J=d.NextRequestAdapter.fromNodeNextRequest($,(0,d.signalFromNodeResponse)(t));try{let i=async e=>R.handle(J,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=W.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${U} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${y}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),l=async s=>{var n,l;let d=async({previousCacheEntry:a})=>{try{if(!o&&C&&I&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=H.renderOpts.fetchMetrics;let l=H.renderOpts.pendingWaitUntil;l&&r.waitUntil&&(r.waitUntil(l),l=void 0);let d=H.renderOpts.collectedTags;if(!k)return await (0,p.sendResponse)($,X,n,H.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[h.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,r=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await R.onRequestError(e,t,{routerKind:"App Router",routePath:y,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:C})},!1,b),t}},c=await R.handleResponse({req:e,nextConfig:T,cacheKey:D,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:_,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:I,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:o});if(!k)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",C?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),w&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,m.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&k||f.delete(h.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)($,X,new Response(c.value.body,{headers:f,status:c.value.status||200})),null};q?await l(q):await W.withPropagatedContext(e.headers,()=>W.trace(c.BaseServerSpan.handleRequest,{spanName:`${U} ${y}`,kind:n.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await R.onRequestError(e,t,{routerKind:"App Router",routePath:F,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:C})},!1,b),k)throw t;return await (0,p.sendResponse)($,X,new Response(null,{status:500})),null}}e.s(["handler",0,I,"patchFetch",0,function(){return(0,r.patchFetch)({workAsyncStorage:_,workUnitAsyncStorage:b})},"routeModule",0,R,"serverHooks",0,C,"workAsyncStorage",0,_,"workUnitAsyncStorage",0,b],824332)}];

//# sourceMappingURL=9f3ab_next_dist_esm_build_templates_app-route_b77033e5.js.map