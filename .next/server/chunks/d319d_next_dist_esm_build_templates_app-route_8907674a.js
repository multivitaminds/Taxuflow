module.exports=[411719,e=>{"use strict";var t=e.i(516850),a=e.i(371100),s=e.i(397035),r=e.i(873968),n=e.i(649549),i=e.i(961840),o=e.i(153224),l=e.i(307998),d=e.i(529137),c=e.i(399762),u=e.i(650651),p=e.i(909836),m=e.i(518468),g=e.i(381254),h=e.i(808862),f=e.i(193695);e.i(164196);var v=e.i(534815),E=e.i(861874),y=e.i(456699),N=e.i(254799);function x(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}async function T(){console.log("[v0] Server env check:",{hasUrl:!!process.env.NEXT_PUBLIC_SUPABASE_URL,hasKey:!!process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY});let e=process.env.TAXBANDITS_CLIENT_ID,t=process.env.TAXBANDITS_API_SECRET;if(!e||!t)throw console.log("[v0] TaxBandits credentials not configured, using demo mode"),Error("TaxBandits credentials not configured. Please add TAXBANDITS_CLIENT_ID and TAXBANDITS_API_SECRET environment variables.");let a=process.env.TAXBANDITS_ENVIRONMENT||"sandbox",s=Math.floor(Date.now()/1e3),r=x(Buffer.from(JSON.stringify({alg:"HS256",typ:"JWT"})).toString("base64")),n=x(Buffer.from(JSON.stringify({iss:e,sub:e,aud:"TaxBanditsAPI",iat:s,exp:s+300})).toString("base64")),i=x((0,N.createHmac)("sha256",t).update(`${r}.${n}`).digest("base64")),o=`${r}.${n}.${i}`;console.log("[v0] Requesting TaxBandits access token...");let l=await fetch("production"===a?"https://oauth.expressauth.net/v2/tbsauth":"https://testoauth.expressauth.net/v2/tbsauth",{method:"GET",headers:{Authentication:o}});if(!l.ok){let e=await l.json();throw console.error("[v0] TaxBandits authentication failed:",e),Error(`Failed to authenticate with TaxBandits: ${e.StatusMessage||"Unknown error"}`)}let d=await l.json();return console.log("[v0] TaxBandits authentication successful"),d.AccessToken}async function S(e){try{let t,a;console.log("[v0] POST /api/filing/submit-extracted - Request received");try{t=await e.json()}catch(e){return console.error("[v0] Failed to parse request body:",e),E.NextResponse.json({success:!1,error:"Invalid request body"},{status:400})}let{userId:s,documents:r}=t;if(!r||!Array.isArray(r)||0===r.length)return console.error("[v0] Invalid documents array"),E.NextResponse.json({success:!1,error:"No documents provided"},{status:400});console.log("[v0] Submitting extracted documents, count:",r?.length),console.log("[v0] Document types:",r?.map(e=>e.documentType));let n=await (0,y.createClient)(),{data:{user:i},error:o}=await n.auth.getUser();if(o||!i)return console.error("[v0] Authentication failed:",o),E.NextResponse.json({success:!1,error:"Unauthorized"},{status:401});console.log("[v0] User authenticated:",i.id);try{a=await T()}catch(e){return console.error("[v0] Failed to get TaxBandits access token:",e),E.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to authenticate with TaxBandits"},{status:500})}let l=[];for(let e of r)try{let{documentType:t,taxYear:s,employer:r,employee:o,payer:d,recipient:c,income:u,isTemplateData:p}=e;if(console.log("[v0] Processing document type:",t),console.log("[v0] Full document data:",JSON.stringify(e,null,2)),!0===p)throw Error("This document contains template or demonstration data and cannot be filed. Please upload a real tax document with actual taxpayer information.");if("w2"===t){let e={SubmissionManifest:{TaxYear:s||new Date().getFullYear()-1,IsFederalFiling:!0,IsStateFiling:!0},ReturnHeader:{Business:{BusinessNm:r?.name,EIN:r?.ein?.replace(/-/g,""),BusinessType:"Corporation"}},FormW2:[{SequenceNum:1,Employee:{SSN:o?.ssn?.replace(/-/g,""),FirstNm:o?.name?.split(" ")[0],LastNm:o?.name?.split(" ").slice(1).join(" "),Address:{AddressLine1:o?.address?.split(",")[0],City:o?.address?.split(",")[1]?.trim(),State:u?.state||"CA",ZipCode:o?.address?.match(/\d{5}/)?.[0]||"00000"}},Wages:u?.wages||0,FederalIncomeTaxWithheld:u?.federalWithholding||0,SocialSecurityWages:u?.socialSecurityWages||0,SocialSecurityTaxWithheld:u?.socialSecurityTax||0,MedicareWages:u?.medicareWages||0,MedicareTaxWithheld:u?.medicareTax||0,StateWages:u?.stateWages||0,StateIncomeTax:u?.stateTax||0}]},t=await fetch("https://testapi.taxbandits.com/v1.7.3/Form/W2",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw console.error("[v0] TaxBandits W-2 submission failed:",e),Error(`TaxBandits W-2 submission failed: ${e.StatusMessage||e.Errors?.[0]?.Message||"Unknown error"}`)}let d=await t.json();console.log("[v0] W-2 submitted successfully:",d.SubmissionId);let{data:c}=await n.from("tax_filings").insert({user_id:i.id,form_type:"W-2",tax_year:s||new Date().getFullYear()-1,filing_status:"single",provider_name:"taxbandits",submission_id:d.SubmissionId,irs_status:"pending",filed_at:new Date().toISOString()}).select().single();l.push(c)}else if("1099-nec"===t){console.log("[v0] Processing 1099-NEC form..."),console.log("[v0] Payer data:",JSON.stringify(d,null,2)),console.log("[v0] Recipient data:",JSON.stringify(c,null,2)),console.log("[v0] Income data:",JSON.stringify(u,null,2));let e=c?.firstName||c?.name?.split(" ")[0]||"",t=c?.lastName||c?.name?.split(" ").slice(1).join(" ")||"",r=c?.ssn?.replace(/[^0-9]/g,"")||c?.ein?.replace(/[^0-9]/g,"")||c?.tin?.replace(/[^0-9]/g,"")||"";if(!r||r.length<9)throw Error("Invalid or missing recipient TIN (SSN/EIN). The document may contain masked or template data. Please upload a document with real taxpayer information.");let o=c?.ssn||c?.ein||c?.tin||"";if(o.includes("X")||o.includes("*"))throw Error("The recipient TIN appears to be masked (e.g., XXX-XX-1234). Please upload a document with the complete, unmasked TIN for filing.");let p=c?.address?.split(",")||[],m=p[0]?.trim()||c?.street||"",g=c?.city||p[1]?.trim()||"",h=c?.state||"",f=c?.zipCode||c?.zip||c?.address?.match(/\d{5}/)?.[0]||"",v=d?.address?.split(",")||[];v[0]?.trim()||d?.street;let E=d?.city||v[1]?.trim()||"",y=d?.state||"",N=d?.zipCode||d?.zip||d?.address?.match(/\d{5}/)?.[0]||"";if(console.log("[v0] Parsed recipient name:",{recipientFirstName:e,recipientLastName:t}),console.log("[v0] Parsed recipient TIN:",r?"***"+r.slice(-4):"MISSING"),console.log("[v0] Parsed recipient address:",{recipientStreet:m,recipientCity:g,recipientState:h,recipientZip:f}),!d?.name||!d?.ein)throw Error("Payer name and EIN are required");if(!e||!t)throw Error("Recipient first and last name are required");let x=Number.parseFloat(u?.nonemployeeCompensation||u?.nonemployee_compensation||u?.compensation||"0"),T=Number.parseFloat(u?.federalTaxWithheld||u?.federal_tax_withheld||u?.federalWithholding||"0");console.log("[v0] Parsed amounts:",{nonemployeeCompensation:x,federalTaxWithheld:T});let S={SubmissionManifest:{TaxYear:s||new Date().getFullYear()-1,IsFederalFiling:!0,IsStateFiling:!0},ReturnHeader:{Business:{BusinessNm:d.name,EIN:d.ein.replace(/[^0-9]/g,""),BusinessType:"Corporation"}},Form1099NEC:[{SequenceNum:1,Recipient:{TIN:r,FirstNm:e,LastNm:t,Address:{AddressLine1:m,City:g,State:h,ZipCode:f}},NonemployeeCompensation:x,FederalIncomeTaxWithheld:T}]};console.log("[v0] 1099-NEC payload prepared:",JSON.stringify(S,null,2));let w=await fetch("https://testapi.taxbandits.com/v1.7.3/Form/1099NEC",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(S)});if(console.log("[v0] TaxBandits response status:",w.status),!w.ok){let e=await w.text();console.error("[v0] TaxBandits 1099-NEC submission failed:",e);let t="Unknown error";try{let a=JSON.parse(e);t=a.StatusMessage||a.Errors?.[0]?.Message||e}catch{t=e}throw Error(`TaxBandits 1099-NEC submission failed: ${t}`)}let _=await w.json();console.log("[v0] 1099-NEC submitted successfully:",_.SubmissionId);let{data:R,error:b}=await n.from("nec_1099_filings").insert({user_id:i.id,submission_id:_.SubmissionId,tax_year:s||new Date().getFullYear()-1,filing_type:"original",irs_status:"pending",taxbandits_status:"Created",payer_name:d.name,payer_ein:d.ein,payer_address:d.address,payer_city:E,payer_state:y,payer_zip:N,recipient_first_name:e,recipient_last_name:t,recipient_address:c.address,recipient_city:g,recipient_state:h,recipient_zip:f,recipient_email:c?.email,nonemployee_compensation:x,federal_tax_withheld:T,submitted_at:new Date().toISOString()}).select().single();if(b)throw console.error("[v0] Failed to save 1099-NEC filing to database:",b),console.error("[v0] Insert error details:",JSON.stringify(b,null,2)),Error(`Failed to save filing: ${b.message}`);console.log("[v0] 1099-NEC filing saved to database:",R.id),l.push(R)}}catch(e){return console.error("[v0] Error processing document:",e),console.error("[v0] Error stack:",e instanceof Error?e.stack:"No stack trace"),E.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to process document",details:e instanceof Error?e.stack:void 0},{status:500})}return console.log("[v0] Successfully submitted",l.length,"filings to TaxBandits"),E.NextResponse.json({success:!0,filings:l,message:`Successfully filed ${l.length} tax form(s)`})}catch(e){return console.error("[v0] Extracted filing submission error:",e),console.error("[v0] Error stack:",e instanceof Error?e.stack:"No stack trace"),E.NextResponse.json({success:!1,error:e instanceof Error?e.message:"Failed to submit filing",details:e instanceof Error?e.stack:void 0},{status:500})}}e.s(["POST",0,S],256073);var w=e.i(256073);let _=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/filing/submit-extracted/route",pathname:"/api/filing/submit-extracted",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/filing/submit-extracted/route.ts",nextConfigOutput:"",userland:w}),{workAsyncStorage:R,workUnitAsyncStorage:b,serverHooks:C}=_;async function A(e,t,s){_.isDev&&(0,r.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let E="/api/filing/submit-extracted/route";E=E.replace(/\/index$/,"")||"/";let y=await _.prepare(e,t,{srcPage:E,multiZoneDraftMode:!1});if(!y)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:N,params:x,nextConfig:T,parsedUrl:S,isDraftMode:w,prerenderManifest:R,routerServerContext:b,isOnDemandRevalidate:C,revalidateOnlyGenerated:A,resolvedPathname:I,clientReferenceManifest:P,serverActionsManifest:O}=y,B=(0,o.normalizeAppPath)(E),F=!!(R.dynamicRoutes[B]||R.routes[I]),k=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,S,!1):t.end("This page could not be found"),null);if(F&&!w){let e=!!R.routes[I],t=R.dynamicRoutes[B];if(t&&!1===t.fallback&&!e){if(T.experimental.adapterPath)return await k();throw new f.NoFallbackError}}let D=null;!F||_.isDev||w||(D="/index"===(D=I)?"/":D);let U=!0===_.isDev||!F,j=F&&!U;O&&P&&(0,i.setManifestsSingleton)({page:E,clientReferenceManifest:P,serverActionsManifest:O});let M=e.method||"GET",W=(0,n.getTracer)(),q=W.getActiveScopeSpan(),H={params:x,prerenderManifest:R,renderOpts:{experimental:{authInterrupts:!!T.experimental.authInterrupts},cacheComponents:!!T.cacheComponents,supportsDynamicResponse:U,incrementalCache:(0,r.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:T.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,s,r)=>_.onRequestError(e,t,s,r,b)},sharedContext:{buildId:N}},$=new l.NodeNextRequest(e),X=new l.NodeNextResponse(t),L=d.NextRequestAdapter.fromNodeNextRequest($,(0,d.signalFromNodeResponse)(t));try{let i=async e=>_.handle(L,H).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=W.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=a.get("next.route");if(s){let t=`${M} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${M} ${E}`)}),o=!!(0,r.getRequestMeta)(e,"minimalMode"),l=async r=>{var n,l;let d=async({previousCacheEntry:a})=>{try{if(!o&&C&&A&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(r);e.fetchMetrics=H.renderOpts.fetchMetrics;let l=H.renderOpts.pendingWaitUntil;l&&s.waitUntil&&(s.waitUntil(l),l=void 0);let d=H.renderOpts.collectedTags;if(!F)return await (0,p.sendResponse)($,X,n,H.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,m.toNodeOutgoingHttpHeaders)(n.headers);d&&(t[h.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==H.renderOpts.collectedRevalidate&&!(H.renderOpts.collectedRevalidate>=h.INFINITE_CACHE)&&H.renderOpts.collectedRevalidate,s=void 0===H.renderOpts.collectedExpire||H.renderOpts.collectedExpire>=h.INFINITE_CACHE?void 0:H.renderOpts.collectedExpire;return{value:{kind:v.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:s}}}}catch(t){throw(null==a?void 0:a.isStale)&&await _.onRequestError(e,t,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:C})},!1,b),t}},c=await _.handleResponse({req:e,nextConfig:T,cacheKey:D,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:R,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:A,responseGenerator:d,waitUntil:s.waitUntil,isMinimalMode:o});if(!F)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==v.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",C?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),w&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let f=(0,m.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&F||f.delete(h.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||f.get("Cache-Control")||f.set("Cache-Control",(0,g.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)($,X,new Response(c.value.body,{headers:f,status:c.value.status||200})),null};q?await l(q):await W.withPropagatedContext(e.headers,()=>W.trace(c.BaseServerSpan.handleRequest,{spanName:`${M} ${E}`,kind:n.SpanKind.SERVER,attributes:{"http.method":M,"http.target":e.url}},l))}catch(t){if(t instanceof f.NoFallbackError||await _.onRequestError(e,t,{routerKind:"App Router",routePath:B,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:C})},!1,b),F)throw t;return await (0,p.sendResponse)($,X,new Response(null,{status:500})),null}}e.s(["handler",0,A,"patchFetch",0,function(){return(0,s.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:b})},"routeModule",0,_,"serverHooks",0,C,"workAsyncStorage",0,R,"workUnitAsyncStorage",0,b],411719)}];

//# sourceMappingURL=d319d_next_dist_esm_build_templates_app-route_8907674a.js.map